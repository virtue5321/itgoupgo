<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê²Œì‹œê¸€ ê´€ë¦¬</title>
    <%-- ğŸ’¡ CSS íŒŒì¼ ê²½ë¡œ í™•ì¸ --%>
    <link rel="stylesheet" href="<c:url value="/resources/css/adminStyle.css" />">
    <style>
        /* memberManage.jspì—ì„œ ë³µì‚¬ëœ ìŠ¤íƒ€ì¼ì„ ìµœëŒ€í•œ ìœ ì§€í•©ë‹ˆë‹¤. */
        .pagination-container {
            display: flex;
            justify-content: center;
            padding: 20px 0;
            gap: 5px;
        }
        .pagination-container a, .pagination-container span {
            padding: 8px 12px;
            text-decoration: none;
            color: #333;
            border: 1px solid #ddd;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        .pagination-container a:hover {
            background-color: #f0f0f0;
        }
        .pagination-container .active {
            background-color: #5a5ce8; /* ì›ë³¸ì—ì„œ ì‚¬ìš©ëœ ìƒ‰ìƒìœ¼ë¡œ ì¶”ì • */
            color: white;
            border-color: #5a5ce8;
        }
        
        /* ìƒíƒœ í‘œì‹œ ìƒ‰ìƒ */
        .status-active { color: #28a745; font-weight: 500; } /* ì •ìƒ */
        .status-deleted { color: #dc3545; font-weight: 500; } /* ì‚­ì œë¨ */
        
        /* í…Œì´ë¸” í˜¸ë²„ íš¨ê³¼ (ì›ë³¸ memberManage.jsp ì½”ë“œ ê¸°ë°˜) */
        .table tbody tr:hover {
            background-color: #f7f7f7;
            cursor: pointer;
        }
        .no-data {
            text-align: center;
            padding: 20px;
            color: #777;
        }
    </style>
</head>
<body>

    <div class="wrap">
        
        <%-- ğŸ’¡ í—¤ë” ë° ì‚¬ì´ë“œë°”ëŠ” ë³„ë„ë¡œ include í•œë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤. --%>
        <%-- <c:import url="../common/adminHeader.jsp" /> --%>
        <%-- <c:import url="../common/adminSidebar.jsp" /> --%>

        <div class="content">
            <h2 class="page-title">ê²Œì‹œê¸€ ê´€ë¦¬</h2>

            <div class="search-area">
                <form action="${pageContext.request.contextPath}/admin/posts/list" method="get">
                    <select name="searchType" class="search-select">
                        <option value="title" <c:if test="${param.searchType eq 'title'}">selected</c:if>>ì œëª©</option>
                        <option value="memberNo" <c:if test="${param.searchType eq 'memberNo'}">selected</c:if>>ì‘ì„±ì No</option>
                        <option value="boardType" <c:if test="${param.searchType eq 'boardType'}">selected</c:if>>ê²Œì‹œíŒ ì¢…ë¥˜</option>
                    </select>
                    <input type="text" name="searchKeyword" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" class="search-input" value="${param.searchKeyword}">
                    <button type="submit" class="search-btn">ê²€ìƒ‰</button>
                </form>
            </div>

            <div class="board-top">
                <div class="count-text">
                    ì´ ê²Œì‹œê¸€ ìˆ˜: <strong><c:out value="${pageInfo.listCount}" default="0"/></strong>ê±´
                </div>
                <div class="action-buttons">
                    <%-- memberManage.jspì˜ ë²„íŠ¼ í´ë˜ìŠ¤(btn-warning, btn-success)ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. --%>
                    <button type="button" class="btn btn-warning" onclick="confirmPostAction('DELETE');">
                        ì„ íƒ ê²Œì‹œê¸€ ì‚­ì œ (ìƒíƒœ N)
                    </button>
                    <button type="button" class="btn btn-success" onclick="confirmPostAction('RESTORE');">
                        ì„ íƒ ê²Œì‹œê¸€ ë³µêµ¬ (ìƒíƒœ Y)
                    </button>
                </div>
            </div>

            <%-- ğŸ’¡ ê²Œì‹œê¸€ ìƒíƒœ ë³€ê²½ì„ ìœ„í•œ í¼ (POST ìš”ì²­) --%>
            <form id="postActionForm" action="${pageContext.request.contextPath}/admin/posts/updateStatus" method="POST">
                
                <table class="table">
                    <thead>
                        <tr>
                            <th style="width: 50px;">
                                <input type="checkbox" id="selectAllCheckboxPost">
                            </th>
                            <th style="width: 50px;">No.</th>
                            <th style="width: 80px;">ê²Œì‹œíŒ</th>
                            <th style="min-width: 250px;">ì œëª©</th>
                            <th style="width: 100px;">ì‘ì„±ì No</th>
                            <th style="width: 120px;">ì‘ì„±ì¼</th>
                            <th style="width: 80px;">ì¡°íšŒìˆ˜</th>
                            <th style="width: 80px;">ìƒíƒœ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <%-- postListëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì „ë‹¬ë°›ì€ ê²Œì‹œê¸€ ëª©ë¡ì…ë‹ˆë‹¤. --%>
                        <c:choose>
                            <c:when test="${not empty postList}">
                                <c:forEach var="post" items="${postList}">
                                    <tr onclick="location.href='<c:url value="/admin/posts/detail?no=${post.postNo}"/>';">
                                        <%-- ì²´í¬ë°•ìŠ¤ í´ë¦­ ì‹œ TRì˜ onclick ì´ë²¤íŠ¸ê°€ ì‹¤í–‰ë˜ì§€ ì•Šë„ë¡ ì´ë²¤íŠ¸ ë²„ë¸”ë§ì„ ë§‰ìŠµë‹ˆë‹¤. --%>
                                        <td onclick="event.stopPropagation();"> 
                                            <input type="checkbox" class="itemCheckboxPost" value="${post.postNo}">
                                        </td>
                                        <td><c:out value="${post.postNo}" /></td>
                                        <td><c:out value="${post.boardType}" /></td> <%-- ì˜ˆì‹œ: FREE, INFO, NOTICE, STUDY, IT --%>
                                        <td><c:out value="${post.postTitle}" /></td>
                                        <td><c:out value="${post.memberNo}" /></td>
                                        <td>
                                            <fmt:formatDate value="${post.postCreateDate}" pattern="yyyy-MM-dd" />
                                        </td>
                                        <td><c:out value="${post.postView}" /></td>
                                        <td>
                                            <c:choose>
                                                <c:when test="${post.postDeleteStatus eq 'N'}">
                                                    <span class="status-active">ì •ìƒ</span>
                                                </c:when>
                                                <c:otherwise>
                                                    <span class="status-deleted">ì‚­ì œë¨</span>
                                                </c:otherwise>
                                            </c:choose>
                                        </td>
                                    </tr>
                                </c:forEach>
                            </c:when>
                            <c:otherwise>
                                <tr>
                                    <td colspan="8" class="no-data">ì¡°íšŒëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</td>
                                </tr>
                            </c:otherwise>
                        </c:choose>
                    </tbody>
                </table>

                <%-- ì‹¤ì œ ìƒíƒœ ë³€ê²½ ì‘ì—…ì„ ìœ„í•œ Hidden í•„ë“œ --%>
                <input type="hidden" name="actionType" id="actionType" value="">
                <%-- ì„ íƒëœ ê²Œì‹œê¸€ ë²ˆí˜¸ ëª©ë¡ì€ JavaScriptì—ì„œ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ --%>
            </form>
            
            <%-- ğŸ’¡ í˜ì´ì§• ë°” ì˜ì—­ --%>
            <div class="pagination-container">
                <%-- PageInfo ê°ì²´ì— queryStrì´ í¬í•¨ë˜ì–´ ìˆë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤. --%>
                <c:set var="queryStr" value="searchType=${param.searchType}&searchKeyword=${param.searchKeyword}" />
                
                <%-- ì´ì „ í˜ì´ì§€ ê·¸ë£¹ --%>
                <c:if test="${pageInfo.currentPage > pageInfo.pageLimit}">
                    <a href="${pageContext.request.contextPath}/admin/posts/list?currentPage=${pageInfo.startPage - 1}&${queryStr}">&laquo;</a>
                </c:if>

                <%-- í˜ì´ì§€ ë²ˆí˜¸ ëª©ë¡ --%>
                <c:forEach var="p" begin="${pageInfo.startPage}" end="${pageInfo.endPage}">
                    <c:choose>
                        <c:when test="${p eq pageInfo.currentPage}">
                            <span class="active">${p}</span>
                        </c:when>
                        <c:otherwise>
                            <a href="${pageContext.request.contextPath}/admin/posts/list?currentPage=${p}&${queryStr}">${p}</a>
                        </c:otherwise>
                    </c:choose>
                </c:forEach>

                <%-- ë‹¤ìŒ í˜ì´ì§€ ê·¸ë£¹ --%>
                <c:if test="${pageInfo.currentPage < pageInfo.maxPage and pageInfo.endPage < pageInfo.maxPage}">
                    <a href="${pageContext.request.contextPath}/admin/posts/list?currentPage=${pageInfo.endPage + 1}&${queryStr}">&raquo;</a>
                </c:if>
            </div>

        </div>
    </div>

    <script>
        // 1. ê²Œì‹œê¸€ ìƒíƒœ ë³€ê²½ ì²˜ë¦¬ í•¨ìˆ˜
        function confirmPostAction(action) {
            const selectedCheckboxes = document.querySelectorAll('.itemCheckboxPost:checked');
            const form = document.getElementById('postActionForm');
            const actionTypeInput = document.getElementById('actionType');

            if (selectedCheckboxes.length === 0) {
                alert('ë¨¼ì € ì²˜ë¦¬í•  ê²Œì‹œê¸€ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            let message = '';
            if (action === 'DELETE') {
                message = selectedCheckboxes.length + 'ê°œì˜ ê²Œì‹œê¸€ì„ ì •ë§ë¡œ ì‚­ì œ ì²˜ë¦¬(ìƒíƒœ: N) í•˜ì‹œê² ìŠµë‹ˆê¹Œ?';
                actionTypeInput.value = 'N'; // ì‚­ì œ ìƒíƒœ
            } else if (action === 'RESTORE') {
                message = selectedCheckboxes.length + 'ê°œì˜ ê²Œì‹œê¸€ì„ ì •ë§ë¡œ ë³µêµ¬ ì²˜ë¦¬(ìƒíƒœ: Y) í•˜ì‹œê² ìŠµë‹ˆê¹Œ?';
                actionTypeInput.value = 'Y'; // ì •ìƒ ìƒíƒœ
            } else {
                return;
            }

            if (confirm(message)) {
                // ê¸°ì¡´ì— ì¶”ê°€ëœ postNoListë¥¼ ëª¨ë‘ ì œê±°
                form.querySelectorAll('input[name="postNoList"]').forEach(input => input.remove());

                // ì„ íƒëœ ì²´í¬ë°•ìŠ¤ì˜ valueë¥¼ hidden inputìœ¼ë¡œ í¼ì— ì¶”ê°€í•˜ì—¬ ì „ì†¡
                selectedCheckboxes.forEach(checkbox => {
                    const hiddenInput = document.createElement('input');
                    hiddenInput.type = 'hidden';
                    hiddenInput.name = 'postNoList'; // Controllerì˜ @RequestParam ì´ë¦„ê³¼ ì¼ì¹˜
                    hiddenInput.value = checkbox.value;
                    form.appendChild(hiddenInput);
                });
                
                form.submit(); // POST ìš”ì²­ ì „ì†¡
            }
        }

        // 2. ì²´í¬ë°•ìŠ¤ ì „ì²´ ì„ íƒ/í•´ì œ ê¸°ëŠ¥ (memberManage.jspì™€ ë™ì¼í•œ ë¡œì§ ì‚¬ìš©)
        document.addEventListener('DOMContentLoaded', (event) => {
            const selectAllCheckbox = document.getElementById('selectAllCheckboxPost');
            const itemCheckboxes = document.querySelectorAll('.itemCheckboxPost');
            const tableBodyRows = document.querySelectorAll('.table tbody tr');

            // 1) ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ í´ë¦­ ì‹œ
            selectAllCheckbox.addEventListener('change', function() {
                itemCheckboxes.forEach(checkbox => {
                    checkbox.checked = this.checked;
                });
            });
            
            // 2) ê°œë³„ í•­ëª© ì²´í¬ë°•ìŠ¤ ìƒíƒœ ë³€ê²½ ì‹œ
            itemCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    const checkedItems = document.querySelectorAll('.itemCheckboxPost:checked').length;
                    if (!checkbox.checked) {
                        // í•˜ë‚˜ë¼ë„ í•´ì œë˜ë©´ ì „ì²´ ì„ íƒ í•´ì œ
                        selectAllCheckbox.checked = false;
                    } else if (checkedItems === itemCheckboxes.length) {
                        // ëª¨ë“  í•­ëª©ì´ ì„ íƒë˜ë©´ ì „ì²´ ì„ íƒ
                        selectAllCheckbox.checked = true;
                    }
                });
            });

            // 3) í–‰ í´ë¦­ ì‹œ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ëŠ” ê¸°ëŠ¥
            tableBodyRows.forEach(row => {
                row.addEventListener('click', function(e) {
                    // í´ë¦­ëœ ìš”ì†Œê°€ ì²´í¬ë°•ìŠ¤ì´ë©´ ìƒì„¸ í˜ì´ì§€ ì´ë™ì„ ë§‰ìŠµë‹ˆë‹¤.
                    if (e.target.type !== 'checkbox') {
                        // TRì˜ onclick ì†ì„±ìœ¼ë¡œ ëŒ€ì²´
                        // location.href = this.getAttribute('onclick').match(/location.href='(.*?)'/)[1]; 
                    }
                });
            });
        });
    </script>
</body>
</html>
