<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%-- JSTL Core íƒœê·¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ (ë²”ìš© ê²½ë¡œë¡œ ë³€ê²½) --%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%-- JSTL Format íƒœê·¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ --%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>

<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ê²Œì‹œê¸€ ê´€ë¦¬</title>
<link rel="stylesheet" href="<c:url value="/resources/css/adminStyle.css" />">
<style>
/* ------------------------------------------------ /
/ ê´€ë¦¬ì í˜ì´ì§€ ë ˆì´ì•„ì›ƒ (ì œê³µëœ ì½”ë“œì˜ ìŠ¤íƒ€ì¼) /
/ ------------------------------------------------ /
body { font-family: 'Malgun Gothic', 'Dotum', sans-serif; background-color: #f4f7fa; color: #333; margin: 0; padding: 0; }
header { background-color: #5a5ce8; color: white; padding: 15px 30px; display: flex; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header .logo { display: flex; align-items: center; font-size: 24px; font-weight: bold; }
header .logo img { margin-right: 10px; border-radius: 50%; }
.layout { display: flex; min-height: calc(100vh - 65px - 50px); } / í—¤ë”, í‘¸í„° ë†’ì´ ê³ ë ¤ /
.sidebar { width: 250px; background-color: #ffffff; padding: 20px 0; box-shadow: 2px 0 5px rgba(0,0,0,0.05); }
.sidebar ul { list-style: none; padding: 0; margin: 0; }
.sidebar li a { display: block; padding: 15px 30px; text-decoration: none; color: #333; font-weight: 500; transition: background-color 0.2s; }
.sidebar li a:hover, .sidebar li a.active { background-color: #e9e9e9; color: #5a5ce8; }
main { flex-grow: 1; padding: 30px; }
h1 { color: #5a5ce8; margin-top: 0; border-bottom: 2px solid #e9e9e9; padding-bottom: 10px; }
footer { background-color: #333; color: white; text-align: center; padding: 15px 0; font-size: 14px; }
/ ë²„íŠ¼ ê³µí†µ ìŠ¤íƒ€ì¼ */
.btn { padding: 8px 15px; border-radius: 4px; cursor: pointer; transition: opacity 0.2s; font-weight: 500; }
.btn-danger { background:#dc3545; color:white; border:none; }
.btn-danger:hover { opacity: 0.9; }

/* ------------------------------------------------ /
/ ê²Œì‹œê¸€ ê´€ë¦¬ ê¸°ëŠ¥ ê´€ë ¨ ìŠ¤íƒ€ì¼ (ë™ì  ë°ì´í„°ìš©) /
/ ------------------------------------------------ */

/* 1. ê²Œì‹œíŒ ì„ íƒ ë²„íŠ¼ ì»¨í…Œì´ë„ˆ */
.board-select-container {
margin-bottom: 20px;
padding: 15px;
background: #ffffff;
border-radius: 10px;
box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}
.board-select-container button {
padding: 8px 15px;
margin-right: 5px;
border: 1px solid #ccc;
border-radius: 4px;
background-color: #f8f8f8;
cursor: pointer;
transition: background-color 0.2s, border-color 0.2s;
font-size: 14px;
}
.board-select-container button:hover {
background-color: #e9e9e9;
}
.board-select-container button.active {
background-color: #5a5ce8;
color: white;
border-color: #5a5ce8;
font-weight: bold;
}

/* 2. í…Œì´ë¸” ìŠ¤íƒ€ì¼ /
.admin-table {
width: 100%;
background: white;
border-collapse: collapse;
text-align: center;
border-radius: 8px;
overflow: hidden;
box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}
.admin-table th, .admin-table td {
padding: 12px;
border-bottom: 1px solid #eee;
}
.admin-table th {
background: #f3f4f6;
font-weight: 600;
color: #555;
}
.admin-table tbody tr:hover {
background-color: #f9f9f9;
}
/ í…Œì´ë¸” ì»¬ëŸ¼ í­ ì¡°ì • (PostVOì— ë§ì¶˜ ìƒˆë¡œìš´ ì»¬ëŸ¼ êµ¬ì„±) /
.admin-table th:nth-child(2), .admin-table td:nth-child(2) { width: 10%; } / ê²Œì‹œíŒ ì´ë¦„ /
.admin-table th:nth-child(3), .admin-table td:nth-child(3) { width: 45%; text-align: left; } / ì œëª© /
.admin-table th:nth-child(4), .admin-table td:nth-child(4) { width: 10%; } / ì‘ì„±ì /
.admin-table th:nth-child(5), .admin-table td:nth-child(5) { width: 15%; } / ì‘ì„±ì¼ /
.admin-table th:nth-child(6), .admin-table td:nth-child(6) { width: 5%; } / ì¡°íšŒìˆ˜ /
.admin-table th:nth-child(7), .admin-table td:nth-child(7) { width: 5%; } / ìƒíƒœ */

/* 3. í˜ì´ì§•ë°” ìŠ¤íƒ€ì¼ */
.pagination-container {
display: flex;
justify-content: center;
padding: 20px 0;
gap: 5px;
}
.pagination-container a, .pagination-container span {
padding: 8px 12px;
text-decoration: none;
color: #333;
border: 1px solid #ddd;
border-radius: 4px;
transition: background-color 0.3s;
}
.pagination-container a:hover {
background-color: #f0f0f0;
}
.pagination-container .active {
background-color: #5a5ce8;
color: white;
font-weight: bold;
border-color: #5a5ce8;
}

/* ------------------------------------------------ /
/ ë°˜ì‘í˜• ë””ìì¸ì„ ìœ„í•œ ë¯¸ë””ì–´ ì¿¼ë¦¬ ì¶”ê°€ (1000px ì´í•˜ì¼ ë•Œ ë ˆì´ì•„ì›ƒ ë³€ê²½) /
/ ------------------------------------------------ /
@media (max-width: 1000px) {
.layout {
/ ì‚¬ì´ë“œë°”ì™€ ë©”ì¸ ì»¨í…ì¸ ë¥¼ ì„¸ë¡œë¡œ ìŒ“ìŠµë‹ˆë‹¤. */
display: block;
min-height: auto;
}

.sidebar {
    /* ì‚¬ì´ë“œë°”ê°€ ì „ì²´ ë„ˆë¹„ë¥¼ ì°¨ì§€í•˜ë„ë¡ í•©ë‹ˆë‹¤. */
    width: 100%;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    margin-bottom: 20px;
    padding: 10px 0;
}

.sidebar ul {
    /* ëª¨ë°”ì¼ì—ì„œ ë©”ë‰´ë¥¼ ê°€ë¡œë¡œ ë°°ì¹˜í•˜ê³ , ë©”ë‰´ê°€ ë§ì„ ê²½ìš° ê°€ë¡œ ìŠ¤í¬ë¡¤ ê°€ëŠ¥ */
    display: flex;
    overflow-x: auto;
    white-space: nowrap;
    padding: 0 20px;
}

.sidebar li {
    /* ë©”ë‰´ í•­ëª©ì´ ê°€ë¡œë¡œ ë‚˜ì—´ë˜ë„ë¡ ë³€ê²½ */
    display: inline-block;
    flex-shrink: 0; /* ë©”ë‰´ê°€ ë§ì•„ë„ ì¤„ì–´ë“¤ì§€ ì•Šë„ë¡ ì„¤ì • */
}

.sidebar li a {
    /* ë©”ë‰´ í•­ëª© íŒ¨ë”© ì¡°ì • */
    padding: 10px 15px;
    border-radius: 4px; /* ë²„íŠ¼ì²˜ëŸ¼ ë³´ì´ê²Œ */
    margin-right: 5px;
}

main {
    /* ë©”ì¸ ì»¨í…ì¸ ì˜ íŒ¨ë”© ì¡°ì • */
    padding: 15px;
}

/* ëª¨ë°”ì¼ í™˜ê²½ì—ì„œ í…Œì´ë¸” ê°€ë…ì„± í–¥ìƒì„ ìœ„í•´ ê¸€ê¼´ í¬ê¸° ì¡°ì • */
.admin-table {
    font-size: 12px;
}
.admin-table th, .admin-table td {
     padding: 8px;
}
/* ì¤‘ìš”: ì œëª© ì—´ì„ ì œì™¸í•˜ê³ ëŠ” í­ì„ ìµœì†Œí™”í•˜ì—¬ ê°€ë¡œ ìŠ¤í¬ë¡¤ ë°©ì§€ */
.admin-table th:nth-child(3), .admin-table td:nth-child(3) { width: 50%; }


}
</style>

</head>
<body>
<header>
<div class="logo">
<img src="<c:url value="/resources/images/logo.png" />" width="40"> <!-- ë¡œê³  í¬ê¸° ì¡°ì • -->
ê´€ë¦¬ì í˜ì´ì§€
</div>
</header>

<div class="layout">
<aside class="sidebar">
<ul>
<li><a href="<c:url value="/admin/dashboard" />">ğŸ  ëŒ€ì‹œë³´ë“œ</a></li>
<li><a href="<c:url value="/admin/member" />">ğŸ‘¥ íšŒì› ê´€ë¦¬</a></li>
<li><a href="<c:url value="/admin/post" />" class="active">ğŸ“ ê²Œì‹œê¸€ ê´€ë¦¬</a></li>
<li><a href="<c:url value="/admin/reply" />">ğŸ’¬ ëŒ“ê¸€ ê´€ë¦¬</a></li>
<li><a href="<c:url value="/admin/stats" />">ğŸ“Š í†µê³„</a></li>
<li><a href="<c:url value="/member/logout" />">ğŸšª ë¡œê·¸ì•„ì›ƒ</a></li> <!-- ë¡œê·¸ì•„ì›ƒ ê²½ë¡œ ì¶”ì • -->
</ul>
</aside>

<main>
<h1>ğŸ“ ê²Œì‹œê¸€ ê´€ë¦¬</h1>
<p>ì „ì²´ ê²Œì‹œíŒì˜ ê²Œì‹œê¸€ì„ í†µí•© ê´€ë¦¬í•©ë‹ˆë‹¤.</p>

<!-- 1. ê²Œì‹œíŒë³„ ì„ íƒ ë²„íŠ¼ (ë™ì  í•„í„°ë§) -->

<!-- Controllerì—ì„œ ì „ë‹¬ë°›ì€ boardListì™€ í˜„ì¬ ì„ íƒëœ boardCode(null/ALLì´ë©´ ì „ì²´)ë¥¼ ì‚¬ìš© -->

<div class="board-select-container">
<c:forEach var="board" items="${boardList}&quot;&gt;
&lt;button 
class=&quot;${boardCode eq board.code ? 'active' : ''}"
onclick="location.href='<c:url value="/admin/post?boardCode=${board.code}&cpage=1"/>'"
>
${board.name}
&lt;/button&gt;
&lt;/c:forEach&gt;
&lt;button 
class=&quot;${empty boardCode || boardCode eq 'ALL' ? 'active' : ''}"
onclick="location.href='<c:url value="/admin/post?boardCode=ALL&cpage=1"/>'"
>
ì „ì²´ ê²Œì‹œê¸€
</button>
</div>

<!-- 2. ê´€ë¦¬ ë²„íŠ¼ ë° ê²€ìƒ‰ -->

<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
<button class="btn btn-danger" onclick="deletePosts();">
ì„ íƒ í•­ëª© ì¼ê´„ ì‚­ì œ
</button>

<!-- ê²€ìƒ‰ í¼ -->
<form action="<c:url value="/admin/post" />" method="get" style="display:flex; gap:10px; align-items:center;">
    <!-- í˜„ì¬ boardCodeë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•´ hidden í•„ë“œ ì¶”ê°€ -->
    <input type="hidden" name="boardCode" value="${boardCode}">
    <select name="searchType" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
      <option value="title" ${searchType eq 'title' ? 'selected' : ''}>ì œëª©</option>
      <option value="writer" ${searchType eq 'writer' ? 'selected' : ''}>ì‘ì„±ì</option>
    </select>
    <input type="text" name="keyword" value="${keyword}" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="width: 200px; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
    <button type="submit" style="background:#5a5ce8; color:white; border:none; padding:8px 15px; border-radius:4px; cursor:pointer;">ê²€ìƒ‰</button>
</form>


</div>

<!-- 3. ê²Œì‹œê¸€ ëª©ë¡ í…Œì´ë¸” (ë™ì  ë°ì´í„°) -->

<table class="admin-table">
<thead>
<tr>
<th style="width: 5%;">
<input type="checkbox" id="selectAllCheckboxPost">
</th>
<th>ê²Œì‹œíŒ</th>
<th>ì œëª©</th>
<th>ì‘ì„±ì</th>
<th>ì‘ì„±ì¼</th>
<th>ì¡°íšŒìˆ˜</th>
<th>ìƒíƒœ</th>
</tr>
</thead>
<tbody>
<c:choose>
<c:when test="${empty postList}&quot;&gt;
&lt;tr&gt;
&lt;td colspan=&quot;7&quot;&gt;ì¡°íšŒëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.&lt;/td&gt;
&lt;/tr&gt;
&lt;/c:when&gt;
&lt;c:otherwise&gt;
&lt;c:forEach var=&quot;post&quot; items=&quot;${postList}">
<tr>
<td>
<!-- postNoì™€ boardCodeë¥¼ ì¡°í•©í•˜ì—¬ ì‚­ì œ ìš”ì²­ ì‹œ ì‚¬ìš© -->
<input type="checkbox" class="itemCheckboxPost" name="postData" value="${post.boardCode}:${post.postNo}">
</td>
<td>${post.boardName}&lt;/td&gt;
&lt;td&gt;
&lt;!-- ìƒì„¸ í˜ì´ì§€ ì´ë™ ë§í¬ (ì‹¤ì œ ê²Œì‹œíŒ URLì— ë§ê²Œ ìˆ˜ì • í•„ìš”) --&gt;
&lt;a href=&quot;#&quot; class=&quot;detail-link&quot; data-post-no=&quot;${post.postNo}" data-board-code="${post.boardCode}" style="color: \#333; text-decoration: none;"\>
${post.postTitle}
&lt;/a&gt;
&lt;/td&gt;
&lt;td&gt;${post.memberNick}\</td\>
\<td\>\<fmt:formatDate value="${post.createDate}" pattern="yyyy.MM.dd HH:mm"/></td>
<td>${post.viewCount}\</td\>
\<td\>
\<c:choose\>
\<c:when test="${post.deleteStatus eq 'Y'}"><span style="color: red; font-weight: bold;">[ì‚­ì œ]</span></c:when>
<c:otherwise><span style="color: green;">[ì •ìƒ]</span></c:otherwise>
</c:choose>
</td>
</tr>
</c:forEach>
</c:otherwise>
</c:choose>
</tbody>
</table>

<!-- 4. í˜ì´ì§•ë°” (ë™ì  êµ¬í˜„) -->

<div class="pagination-container">
<c:if test="${pi.currentPage &gt; 1}&quot;&gt;
&lt;%-- í˜„ì¬ boardCode, searchType, keywordë¥¼ ìœ ì§€í•˜ë©° í˜ì´ì§€ ì´ë™ --%&gt;
&lt;a href=&quot;&lt;c:url value=&quot;/admin/post?boardCode=${boardCode}&cpage=${pi.currentPage - 1}&amp;searchType=${searchType}&keyword=${keyword}"/>">&lt;</a>
</c:if>

<c:forEach var="p" begin="${pi.startPage}" end="${pi.endPage}">
    <c:choose>
        <c:when test="${p eq pi.currentPage}">
            <span class="active">${p}</span>
        </c:when>
        <c:otherwise>
            <%-- í˜„ì¬ boardCode, searchType, keywordë¥¼ ìœ ì§€í•˜ë©° í˜ì´ì§€ ì´ë™ --%>
            <a href="<c:url value="/admin/post?boardCode=${boardCode}&cpage=${p}&searchType=${searchType}&keyword=${keyword}"/>">${p}</a>
        </c:otherwise>
    </c:choose>
</c:forEach>

<c:if test="${pi.currentPage < pi.maxPage}">
    <%-- í˜„ì¬ boardCode, searchType, keywordë¥¼ ìœ ì§€í•˜ë©° í˜ì´ì§€ ì´ë™ --%>
    <a href="<c:url value="/admin/post?boardCode=${boardCode}&cpage=${pi.currentPage + 1}&searchType=${searchType}&keyword=${keyword}"/>">&gt;</a>
</c:if>


</div>
</main>
</div>

<footer>â“’ 2025 IT GO UP GO. All Rights Reserved.</footer>

<script>
// 1. ì„ íƒ ê²Œì‹œê¸€ ì¼ê´„ ì‚­ì œ ê¸°ëŠ¥ (AJAX ë˜ëŠ” Form Postë¥¼ í†µí•´ êµ¬í˜„í•´ì•¼ í•¨)
function deletePosts() {
const selectedCheckboxes = document.querySelectorAll('.itemCheckboxPost:checked');
if (selectedCheckboxes.length === 0) {
// alert() ëŒ€ì‹  ì‚¬ìš©ì ì§€ì • UIë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ì§€ë§Œ, ì—¬ê¸°ì„œëŠ” ì„ì‹œë¡œ ì‚¬ìš©
// ğŸš¨ [ì£¼ì˜] ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” alert() ëŒ€ì‹  Modal ë˜ëŠ” Custom Confirm UIë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
alert('ì‚­ì œí•  ê²Œì‹œê¸€ì„ í•˜ë‚˜ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.');
return;
}

// ğŸš¨ ì¤‘ìš”: í¼ ì „ì†¡ ë°©ì‹ (POST)ìœ¼ë¡œ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤.
if (confirm(${selectedCheckboxes.length}ê°œì˜ ê²Œì‹œê¸€ì„ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (DB ìƒíƒœ ë³€ê²½ í•„ìš”))) {

// 1. ì„ì‹œ í¼ ìƒì„± (POST ìš”ì²­ì„ ë³´ë‚´ê¸° ìœ„í•¨)
const form = document.createElement(&#39;form&#39;);
form.method = &#39;POST&#39;;
form.action = &#39;&lt;c:url value=&quot;/admin/deletePosts&quot; /&gt;&#39;; // ì‚­ì œë¥¼ ì²˜ë¦¬í•  Controller Mapping

// 2. ì„ íƒëœ ì²´í¬ë°•ìŠ¤ì˜ value (boardCode:postNo)ë¥¼ hidden inputìœ¼ë¡œ í¼ì— ì¶”ê°€
selectedCheckboxes.forEach(checkbox =&gt; {
    const hiddenInput = document.createElement(&#39;input&#39;);
    hiddenInput.type = &#39;hidden&#39;;
    // ì„œë²„ì—ì„œ ë°°ì—´ë¡œ ë°›ê¸° ìœ„í•´ nameì„ postDataListë¡œ ì„¤ì • (List&lt;String&gt;ìœ¼ë¡œ ë°›ì„ ìˆ˜ ìˆìŒ)
    hiddenInput.name = &#39;postDataList&#39;; 
    hiddenInput.value = checkbox.value; // ì˜ˆ: FREE:1, STUDY:5
    form.appendChild(hiddenInput);
});

// 3. í˜„ì¬ í˜ì´ì§€ URLì„ ë¦¬ë‹¤ì´ë ‰íŠ¸ ê²½ë¡œë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì¶”ê°€
const redirectInput = document.createElement(&#39;input&#39;);
redirectInput.type = &#39;hidden&#39;;
redirectInput.name = &#39;redirectUrl&#39;;
redirectInput.value = window.location.pathname + window.location.search;
form.appendChild(redirectInput);

// 4. í¼ì„ bodyì— ì¶”ê°€í•˜ê³  ì „ì†¡
document.body.appendChild(form);
form.submit();


}
}

// 2. ì²´í¬ë°•ìŠ¤ ì „ì²´ ì„ íƒ/í•´ì œ ê¸°ëŠ¥
document.addEventListener('DOMContentLoaded', (event) => {
// JSTLì´ ì œëŒ€ë¡œ ë¡œë“œë˜ì§€ ì•Šì•„ ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ” ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ DOMContentLoaded ì‚¬ìš©

const selectAllCheckbox = document.getElementById('selectAllCheckboxPost');
const itemCheckboxes = document.querySelectorAll('.itemCheckboxPost');

if (selectAllCheckbox) {
selectAllCheckbox.addEventListener('change', function() {
itemCheckboxes.forEach(checkbox => {
checkbox.checked = this.checked;
});
});
}

itemCheckboxes.forEach(checkbox => {
checkbox.addEventListener('change', () => {
const checkedItems = document.querySelectorAll('.itemCheckboxPost:checked').length;
if (!checkbox.checked) {
if (selectAllCheckbox) selectAllCheckbox.checked = false;
} else if (checkedItems === itemCheckboxes.length) {
if (selectAllCheckbox) selectAllCheckbox.checked = true;
}
});
});

});

// 3. ê²Œì‹œê¸€ ìƒì„¸ ì¡°íšŒ ë§í¬ í´ë¦­ ì‹œ ì²˜ë¦¬ (Controllerì—ì„œ ì²˜ë¦¬í•  í•„ìš”ê°€ ìˆìŒ)
document.querySelectorAll('.detail-link').forEach(link => {
link.addEventListener('click', function(e) {
e.preventDefault();
const postNo = this.dataset.postNo;
const boardCode = this.dataset.boardCode.toLowerCase(); // URLì— ë§ê²Œ ì†Œë¬¸ìë¡œ ë³€í™˜

// ê²Œì‹œíŒ ì½”ë“œì— ë”°ë¼ ìƒì„¸ í˜ì´ì§€ ì´ë™ URLì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.
// ì˜ˆ: /free/detail?no=10, /study/detail?no=5

// ğŸš¨ ì´ ë¶€ë¶„ì€ ì‹¤ì œ ê²Œì‹œíŒì˜ ìƒì„¸ ì¡°íšŒ URL ê·œì¹™ì— ë§ê²Œ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤.
const detailUrl = `/${boardCode}/detail?no=${postNo}`;

// ì„ì‹œë¡œ alert ì²˜ë¦¬
// alert(`[${this.dataset.boardCode}] ê²Œì‹œíŒì˜ ${postNo}ë²ˆ ê¸€ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤. (URL: ${detailUrl})`);

location.href = detailUrl; // ì‹¤ì œ ì´ë™ ì½”ë“œ


});

});
</script>

</body>
</html>