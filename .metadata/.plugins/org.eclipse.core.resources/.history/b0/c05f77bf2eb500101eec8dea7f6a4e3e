package com.itgoupgo.community.admin.model.dao;

import java.util.List;
import java.util.Map;

import org.apache.ibatis.session.RowBounds;
import org.mybatis.spring.SqlSessionTemplate;
import org.springframework.stereotype.Repository;

import com.itgoupgo.community.admin.model.vo.PostVO;
import com.itgoupgo.community.common.model.vo.Pagination;
import com.itgoupgo.community.member.model.vo.Member;

@Repository
public class AdminDao {
	
	/**
     * 1. íšŒì› ì „ì²´ ëª©ë¡ ìˆ˜ ì¡°íšŒ
     */
    public int selectListCount(SqlSessionTemplate sqlSession) {
        // selectOneì€ intë¥¼ ë°˜í™˜í•˜ë„ë¡ MyBatis ì„¤ì •ë˜ì–´ì•¼ í•¨
        return sqlSession.selectOne("adminMapper.selectListCount");
    }
	
	/**
     * 2. í˜„ì¬ í˜ì´ì§€ì— í•´ë‹¹í•˜ëŠ” íšŒì› ëª©ë¡ ì¡°íšŒ
     */
	public List<Member> selectMemberList(SqlSessionTemplate sqlSession, Pagination pageInfo) {
		
        // RowBounds ê°ì²´ë¥¼ ì´ìš©í•˜ì—¬ í˜ì´ì§• ì²˜ë¦¬
        int offset = (pageInfo.getCurrentPage() - 1) * pageInfo.getListLimit(); // ì‹œì‘ í–‰ ê³„ì‚°
        int limit = pageInfo.getListLimit(); // í•œ í˜ì´ì§€ì— ì¡°íšŒí•  í–‰ ìˆ˜

        // org.apache.ibatis.session.RowBounds ê°ì²´ ì‚¬ìš©
        RowBounds rowBounds = new RowBounds(offset, limit); 
        
        // ì¿¼ë¦¬ëŠ” WHERE ì¡°ê±´ ì—†ì´ ì „ì²´ ëª©ë¡ì„ ëŒ€ìƒìœ¼ë¡œ í•¨
		return sqlSession.selectList("adminMapper.selectMemberList", null, rowBounds); 
	}
	
    /**
     * 2. íšŒì› ë‹¨ì¼ íƒˆí‡´
     */
	public int deleteMemberAdmin(SqlSessionTemplate sqlSession, String userId) {
		
		return sqlSession.update("adminMapper.deleteMemberAdmin", userId);
	}
    
    /**
     * 3. ì¼ê´„ íšŒì› íƒˆí‡´
     */
    public int deleteCheckMember(SqlSessionTemplate sqlSession, List<Integer> memberNoList) {
        
        return sqlSession.update("adminMapper.deleteCheckMember", memberNoList);
    }
    
    /**
     * 4. íšŒì› ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰: List<Member> ë°˜í™˜
     */
    public List<Member> searchMemberByName(SqlSessionTemplate sqlSession, String memberName) {
        return sqlSession.selectList("adminMapper.searchMemberByName", memberName);
    }

    /**
     * 5. íšŒì› ì•„ì´ë””ë¡œ ê²€ìƒ‰: Member ë°˜í™˜
     */
    public Member searchMemberById(SqlSessionTemplate sqlSession, String memberId) {
        return sqlSession.selectOne("adminMapper.searchMemberById", memberId);
    }
    
    // ----------------------------------------------------
    // ğŸŸ¢ 6. íšŒì› ìƒì„¸ ì¡°íšŒ ê¸°ëŠ¥ ì¶”ê°€
    // ----------------------------------------------------
    /**
     * íšŒì› ìƒì„¸ ì¡°íšŒ: Member ë‹¨ì¼ ê°ì²´ ë°˜í™˜ ë° selectOne ì‚¬ìš©
     */
    public Member selectMemberDetail(SqlSessionTemplate sqlSession, int memberNo) {
        // MyBatis Mapper ID: adminMapper.selectMemberDetail
        return sqlSession.selectOne("adminMapper.selectMemberDetail", memberNo);
    }
    
 // -----------------------------------------------------
    // ê²Œì‹œê¸€ í†µí•© ì¡°íšŒ ê´€ë ¨ DAO ë©”ì†Œë“œ ì¶”ê°€
    // -----------------------------------------------------

    /**
     * í†µí•© ê²Œì‹œê¸€ ëª©ë¡ì˜ ì „ì²´ ìˆ˜ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤. (í˜ì´ì§• ì²˜ë¦¬ë¥¼ ìœ„í•¨)
     * @param sqlSession
     * @return ì „ì²´ ê²Œì‹œê¸€ ìˆ˜
     */
    public int selectPostListCount(SqlSessionTemplate sqlSession) {
        return sqlSession.selectOne("adminMapper.selectPostListCount");
    }

    /**
     * í˜„ì¬ í˜ì´ì§€ì— í•´ë‹¹í•˜ëŠ” í†µí•© ê²Œì‹œê¸€ ëª©ë¡ì„ ì¡°íšŒí•©ë‹ˆë‹¤.
     * @param sqlSession
     * @param map (startValue, endValue, boardCode)
     * @return í†µí•© PostVO ë¦¬ìŠ¤íŠ¸
     */
    public List<PostVO> selectPostList(SqlSessionTemplate sqlSession, Map<String, Integer> map) {
        // sqlSession.selectList("ì¿¼ë¦¬id", ì „ë‹¬ì¸ì)
        return sqlSession.selectList("adminMapper.selectPostList", map);
    }
    
}