<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>${boardName} 게시글 관리</title> 

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    
    <style>
        body {
            /* 헤더와 메뉴바를 위한 공간 확보 또는 배경색 지정 */
            background-color: #f9f9fb;
        }
        
        /* 이전 답변에서 통일한 스타일 유지 */
        .page-title {
            font-size: 1.6rem;
            font-weight: bold;
            margin-bottom: 1.2rem;
            color: #333;
        }
        .admin-card {
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            padding: 25px;
            min-height: 70vh; /* 콘텐츠가 적을 때도 깔끔하게 보이도록 최소 높이 설정 */
        }
        table th {
            background-color: #f3f4f6;
            font-weight: 600;
        }
        table td, th {
            vertical-align: middle;
        }
        .pagination {
            justify-content: center;
        }
        .action-cell {
             white-space: nowrap;
        }
        
        /* ==================================== */
        /* 💡 관리자 레이아웃을 위한 기본 구조 스타일 */
        /* 이 부분은 실제 레이아웃 방식에 따라 달라집니다. */
        .admin-wrapper {
             display: flex; /* 메뉴바(sidebar)와 콘텐츠 영역(main-content)을 가로로 배치 */
        }
        .main-content {
             flex-grow: 1;
             padding: 20px;
        }
        /* ==================================== */
    </style>
</head>
<body>

    <%-- <jsp:include page="[TODO: header.jsp 경로]" /> --%>

    <div class="admin-wrapper">
        <%-- <jsp:include page="[TODO: sidebar.jsp 경로]" /> --%>
        
        <div class="main-content">
            <div class="container-fluid"> <%-- container 대신 fluid를 사용해 메뉴바 옆 공간을 최대한 활용 --%>

                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2 class="page-title">📂 ${boardName} 관리</h2>
                    <%-- 이 뒤로가기 버튼은 상단/좌측 메뉴가 있다면 불필요할 수 있습니다. --%>
                    <a href="/community/admin/post" class="btn btn-outline-secondary btn-sm back-btn">게시판 목록</a>
                </div>
            
                <div class="admin-card">
                    <form id="postActionForm" action="/community/admin/post/delete" method="post">
                        <div class="d-flex justify-content-start mb-3">
                            <button type="button" class="btn btn-danger btn-sm" onclick="submitPostAction('삭제')">
                                선택 게시글 삭제
                            </button>
                        </div>
            
                        <table class="table table-hover align-middle">
                            <thead>
                                <tr>
                                    <th style="width:5%;"><input type="checkbox" id="selectAllCheckboxPost"></th>
                                    <th style="width:8%;">글번호</th>
                                    <th style="width:30%;">제목</th>
                                    <th style="width:15%;">작성자</th>
                                    <th style="width:12%;">작성일</th>
                                    <th style="width:8%;">조회수</th>
                                    <th style="width:12%;">관리</th>
                                </tr>
                            </thead>
                            <tbody>
                                <c:if test="${empty bbsList}">
                                    <tr>
                                        <td colspan="7" class="text-center text-muted py-4">
                                            등록된 게시글이 없습니다.
                                        </td>
                                    </tr>
                                </c:if>
            
                                <c:forEach var="post" items="${bbsList}">
                                    <tr>
                                        <td><input type="checkbox" class="itemCheckboxPost" name="bbsNoList" value="${post.bbsNo}"></td>
                                        <td>${post.bbsNo}</td>
                                        <td class="text-start">
                                            <a href="/community/admin/post/detail?bbsNo=${post.bbsNo}" class="text-dark text-decoration-none">
                                                ${post.bbsTitle}
                                            </a>
                                            <c:if test="${post.replyCount > 0}">
                                                <span class="badge text-bg-secondary ms-1">${post.replyCount}</span>
                                            </c:if>
                                        </td>
                                        <td>${post.bbsWriter}</td>
                                        <td>${post.createDate}</td>
                                        <td>${post.bbsCount}</td>
                                        
                                        <td class="action-cell">
                                            <a href="/community/admin/post/edit?bbsNo=${post.bbsNo}" class="btn btn-outline-primary btn-sm me-1">수정</a>
                                            <a href="/community/admin/post/delete?bbsNo=${post.bbsNo}" class="btn btn-outline-danger btn-sm" 
                                               onclick="return confirm('${post.bbsNo}번 게시글을 정말 삭제하시겠습니까?');">삭제</a>
                                        </td>
                                    </tr>
                                </c:forEach>
                            </tbody>
                        </table>
                    </form>
            
                    <nav>
                        <ul class="pagination mt-4">
                            <c:if test="${pageInfo.currentPage > 1}">
                                <li class="page-item">
                                    <a class="page-link" href="?currentPage=${pageInfo.currentPage - 1}">이전</a>
                                </li>
                            </c:if>
            
                            <c:forEach var="p" begin="${pageInfo.startPage}" end="${pageInfo.endPage}">
                                <li class="page-item ${p == pageInfo.currentPage ? 'active' : ''}">
                                    <a class="page-link" href="?currentPage=${p}">${p}</a>
                                </li>
                            </c:forEach>
            
                            <c:if test="${pageInfo.currentPage < pageInfo.maxPage}">
                                <li class="page-item">
                                    <a class="page-link" href="?currentPage=${pageInfo.currentPage + 1}">다음</a>
                                </li>
                            </c:if>
                        </ul>
                    </nav>
                </div>
                </div>
        </div> <%-- .main-content 닫는 태그 --%>
    </div> <%-- .admin-wrapper 닫는 태그 --%>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<%-- 선택 삭제 기능용 스크립트 --%>
<script>
    function submitPostAction(actionType) {
        const selectedCheckboxes = document.querySelectorAll('.itemCheckboxPost:checked');
        
        if (selectedCheckboxes.length === 0) {
            alert('선택된 게시글이 없습니다.');
            return;
        }

        if (confirm(`선택된 게시글 ${selectedCheckboxes.length}건을 정말 ${actionType} 처리하시겠습니까?`)) {
            const form = document.getElementById('postActionForm');
            form.action = '/community/admin/post/delete'; 
            form.method = 'post';
            form.submit();
        }
    }

    document.addEventListener('DOMContentLoaded', (event) => {
        const selectAllCheckbox = document.getElementById('selectAllCheckboxPost');
        const itemCheckboxes = document.querySelectorAll('.itemCheckboxPost');

        selectAllCheckbox.addEventListener('change', function() {
            itemCheckboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
        });
        
        itemCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                const checkedItems = document.querySelectorAll('.itemCheckboxPost:checked').length;
                if (!checkbox.checked) {
                    selectAllCheckbox.checked = false;
                } else if (checkedItems === itemCheckboxes.length) {
                    selectAllCheckbox.checked = true;
                }
            });
        });
    });
 </script>
</body>
</html>