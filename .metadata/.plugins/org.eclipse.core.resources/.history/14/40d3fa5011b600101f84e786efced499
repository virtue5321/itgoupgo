package com.itgoupgo.community.admin.controller;

import java.util.ArrayList;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import com.itgoupgo.community.admin.model.service.AdminService;
import com.itgoupgo.community.common.model.vo.Pagination;
import com.itgoupgo.community.free.model.service.FreeService;
import com.itgoupgo.community.free.model.vo.FreeBbs;
import com.itgoupgo.community.info.model.service.InfoService;
import com.itgoupgo.community.info.model.vo.InfoBbs;
import com.itgoupgo.community.it.model.service.ItService;
import com.itgoupgo.community.it.model.vo.ItBbs;
import com.itgoupgo.community.knowledge.model.service.KnowledgeService;
import com.itgoupgo.community.knowledge.model.vo.KnowledgeBbs;
import com.itgoupgo.community.member.model.vo.Member;
import com.itgoupgo.community.notice.model.service.NoticeService;
import com.itgoupgo.community.notice.model.vo.NoticeBbs;
import com.itgoupgo.community.study.model.service.StudyService;
import com.itgoupgo.community.study.model.vo.StudyBbs;

import jakarta.servlet.http.HttpSession;

@Controller
@RequestMapping("/admin")
public class AdminController {
	
	@Autowired
	private AdminService adminService;
    
    @Autowired
    private FreeService freeService;

    @Autowired
    private InfoService infoService;
    
    @Autowired
    private StudyService studyService;
    
    @Autowired
    private NoticeService noticeService;
    
    @Autowired
    private KnowledgeService knowledgeService;
    
    @Autowired
    private ItService itService;
    
    @GetMapping({"", "/dashboard"})
    public String adminDashboard() {
        return "admin/admin"; 
    }
    
    @GetMapping("/post")
    public String postManage() {
    	return "admin/postManage";
    }
    
    @GetMapping("/reply")
    public String replyManage() {
        return "admin/replyManage";
    }

    @GetMapping("/stats")
    public String statsPage() {
        return "admin/stats";
    }

    @GetMapping("/logout")
    public String logout() {
        return "admin/logout";
    }

    // ================= íšŒì› ê´€ë ¨ ê¸°ëŠ¥ (ê¸°ì¡´ ìœ ì§€) =====================
    
    @GetMapping("/member")
    public String memberManage(@RequestParam(value = "currentPage", defaultValue = "1") int currentPage, Model model) {
        int listCount = adminService.selectListCount();
        Pagination pageInfo = adminService.getPagination(currentPage, listCount);
        List<Member> memberList = adminService.selectMemberList(pageInfo);
        model.addAttribute("memberList", memberList);
        model.addAttribute("pageInfo", pageInfo);
        return "admin/memberManage";
    }

    @GetMapping("/memberDetail")
    public String memberDetail(@RequestParam("memberNo") int memberNo, Model model, HttpSession session) {
        Member member = adminService.selectMemberDetail(memberNo);
        if (member == null) {
            session.setAttribute("alertMsg", "í•´ë‹¹ íšŒì› ì •ë³´ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            return "redirect:/admin/member";
        }
        model.addAttribute("member", member);
        return "admin/memberDetail";
    }

    @GetMapping("/delete")
    public String deleteMember(@RequestParam("memberId") String memberId, HttpSession session) {
        int result = adminService.deleteMemberAdmin(memberId);
        session.setAttribute("alertMsg",
                result > 0 ? "íšŒì› (" + memberId + ") íƒˆí‡´ ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤." : "íšŒì› íƒˆí‡´ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        return "redirect:/admin/member";
    }

    @PostMapping("/deleteCheckMember")
    public String deleteCheckMember(@RequestParam(value = "memberNoList", required = false) List<Integer> memberNoList,
                                    HttpSession session) {
        if (memberNoList == null || memberNoList.isEmpty()) {
            session.setAttribute("alertMsg", "ì„ íƒëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.");
            return "redirect:/admin/member";
        }
        int result = adminService.deleteCheckMember(memberNoList);
        if (result == memberNoList.size()) {
            session.setAttribute("alertMsg", result + "ëª…ì˜ íšŒì›ì´ ì„±ê³µì ìœ¼ë¡œ ì¼ê´„ íƒˆí‡´ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
        } else {
            session.setAttribute("alertMsg", "ì¼ê´„ íƒˆí‡´ ì²˜ë¦¬ ì¤‘ ì¼ë¶€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (" + result + "ëª… ì²˜ë¦¬ë¨)");
        }
        return "redirect:/admin/member";
    }

    @GetMapping("/searchMemberName")
    public String searchMemberName(@RequestParam("keyword") String memberName, Model model) {
        List<Member> searchList = adminService.searchMemberByName(memberName);
        model.addAttribute("memberList", searchList);
        model.addAttribute("searchCondition", "searchMemberName");
        model.addAttribute("searchKeyword", memberName);
        return "admin/memberManage";
    }

    @GetMapping("/searchMemberId")
    public String searchMemberId(@RequestParam("keyword") String memberId, Model model) {
        Member m = adminService.searchMemberById(memberId);
        List<Member> searchList = new ArrayList<>();
        if (m != null) searchList.add(m);
        model.addAttribute("memberList", searchList);
        model.addAttribute("searchCondition", "searchMemberId");
        model.addAttribute("searchKeyword", memberId);
        return "admin/memberManage";
    }

    // ================= ììœ ê²Œì‹œíŒ / ì •ë³´ê³µìœ ê²Œì‹œíŒ (ê¸°ì¡´ ìœ ì§€) =====================

    @GetMapping("/freeBbsManage")
    public String freeBbsManage(@RequestParam(value = "currentPage", defaultValue = "1") int currentPage, Model model) {
        int listCount = freeService.selectListCount();
        Pagination pageInfo = adminService.getPagination(currentPage, listCount);
        List<FreeBbs> freeBbsList = freeService.selectList(currentPage);
        model.addAttribute("freeBbsList", freeBbsList);
        model.addAttribute("pageInfo", pageInfo);
        model.addAttribute("boardName", "ììœ  ê²Œì‹œíŒ");
        model.addAttribute("boardCode", "free");
        return "admin/freeBbsManage";
    }

    @GetMapping("/deleteFreeBbs")
    public String deleteFreeBbs(@RequestParam("bbsNo") int bbsNo, RedirectAttributes ra) {
        int result = freeService.deleteFreeBbs(bbsNo);
        ra.addFlashAttribute("message",
                result > 0 ? bbsNo + "ë²ˆ ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œ(ë¹„í™œì„±í™”) ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤." : "ê²Œì‹œê¸€ ì‚­ì œ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        return "redirect:/admin/freeBbsManage";
    }

    @PostMapping("/deleteFreeBbsCheck")
    public String deleteFreeBbsCheck(@RequestParam(value = "bbsNoList", required = false) List<Integer> bbsNoList,
                                     RedirectAttributes ra) {
        if (bbsNoList == null || bbsNoList.isEmpty()) {
            ra.addFlashAttribute("message", "ì„ íƒëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.");
            return "redirect:/admin/freeBbsManage";
        }
        int result = freeService.deleteFreeBbsCheck(bbsNoList);
        ra.addFlashAttribute("message", "ì´ " + result + "ê±´ì˜ ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ì¼ê´„ ì‚­ì œ(ë¹„í™œì„±í™”) ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
        return "redirect:/admin/freeBbsManage";
    }

    @GetMapping("/infoBbsManage")
    public String infoBbsManage(@RequestParam(value = "currentPage", defaultValue = "1") int currentPage, Model model) {
        int listCount = infoService.selectListCount();
        Pagination pageInfo = adminService.getPagination(currentPage, listCount);
        List<InfoBbs> infoBbsList = infoService.selectList(currentPage);
        model.addAttribute("infoBbsList", infoBbsList);
        model.addAttribute("pageInfo", pageInfo);
        model.addAttribute("boardName", "ì •ë³´ ê³µìœ  ê²Œì‹œíŒ");
        model.addAttribute("boardCode", "info");
        return "admin/infoBbsManage";
    }

    @GetMapping("/deleteInfoBbs")
    public String deleteInfoBbs(@RequestParam("infoNo") int infoNo, RedirectAttributes ra) {
        int result = infoService.deleteInfoBbs(infoNo);
        ra.addFlashAttribute("message",
                result > 0 ? infoNo + "ë²ˆ ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œ(ë¹„í™œì„±í™”) ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤." : "ê²Œì‹œê¸€ ì‚­ì œ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        return "redirect:/admin/infoBbsManage";
    }

    @PostMapping("/deleteInfoBbsCheck")
    public String deleteInfoBbsCheck(@RequestParam(value = "bbsNoList", required = false) List<Integer> bbsNoList,
                                     RedirectAttributes ra) {
        if (bbsNoList == null || bbsNoList.isEmpty()) {
            ra.addFlashAttribute("message", "ì„ íƒëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.");
            return "redirect:/admin/infoBbsManage";
        }
        int result = infoService.deleteInfoBbsCheck(bbsNoList);
        ra.addFlashAttribute("message", "ì´ " + result + "ê±´ì˜ ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ì¼ê´„ ì‚­ì œ(ë¹„í™œì„±í™”) ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
        return "redirect:/admin/infoBbsManage";
    }
    
    // ==================== ğŸ“¢ IT ë‰´ìŠ¤ ê²Œì‹œíŒ ì¡°íšŒ ê¸°ëŠ¥ ì¶”ê°€ ====================

    @GetMapping("/itBbsManage")
    public String itBbsManage(@RequestParam(value = "currentPage", defaultValue = "1") int currentPage, Model model) {
        int listCount = itService.selectItListCount();
        Pagination pageInfo = adminService.getPagination(currentPage, listCount);
        List<ItBbs> itBbsList = itService.selectItList(currentPage);
        model.addAttribute("itBbsList", itBbsList);
        model.addAttribute("pageInfo", pageInfo);
        model.addAttribute("boardName", "IT ë‰´ìŠ¤ ê²Œì‹œíŒ");
        model.addAttribute("boardCode", "it");
        return "admin/itBbsManage";
    }

    @GetMapping("/deleteItBbs")
    public String deleteItBbs(@RequestParam("itNo") int itNo, RedirectAttributes ra) {
        int result = itService.deleteItBbs(itNo);
        ra.addFlashAttribute("message",
                result > 0 ? itNo + "ë²ˆ ITë‰´ìŠ¤ ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤." : "ITë‰´ìŠ¤ ê²Œì‹œê¸€ ì‚­ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        return "redirect:/admin/itBbsManage";
    }

    @PostMapping("/deleteItBbsCheck")
    public String deleteItBbsCheck(@RequestParam(value = "bbsNoList", required = false) List<Integer> bbsNoList,
                                   RedirectAttributes ra) {
        if (bbsNoList == null || bbsNoList.isEmpty()) {
            ra.addFlashAttribute("message", "ì„ íƒëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.");
            return "redirect:/admin/itBbsManage";
        }
        int result = itService.deleteItBbsCheck(bbsNoList);
        ra.addFlashAttribute("message", "ì´ " + result + "ê±´ì˜ ITë‰´ìŠ¤ ê²Œì‹œê¸€ì´ ì¼ê´„ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
        return "redirect:/admin/itBbsManage";
    }
    
    // ==================== ğŸ’¡ ì§€ì‹ ê³µìœ  ê²Œì‹œíŒ ì¡°íšŒ ê¸°ëŠ¥ ì¶”ê°€ ====================

    @GetMapping("/knowledgeBbsManage")
    public String knowledgeBbsManage(@RequestParam(value = "currentPage", defaultValue = "1") int currentPage, Model model) {
        int listCount = knowledgeService.selectListCount();
        Pagination pageInfo = adminService.getPagination(currentPage, listCount);
        List<KnowledgeBbs> knowledgeBbsList = knowledgeService.selectList(currentPage);
        model.addAttribute("knowledgeBbsList", knowledgeBbsList);
        model.addAttribute("pageInfo", pageInfo);
        model.addAttribute("boardName", "ì§€ì‹ ê³µìœ  ê²Œì‹œíŒ");
        model.addAttribute("boardCode", "knowledge");
        return "admin/knowledgeBbsManage";
    }
    
    @GetMapping("/deleteKnowledgeBbs")
    public String deleteKnowledgeBbs(@RequestParam("knowledgeNo") int knowledgeNo, RedirectAttributes ra) {
        int result = knowledgeService.deleteKnowledgeBbs(knowledgeNo);
        ra.addFlashAttribute("message",
                result > 0 ? knowledgeNo + "ë²ˆ ì§€ì‹ê³µìœ  ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤." : "ì§€ì‹ê³µìœ  ê²Œì‹œê¸€ ì‚­ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        return "redirect:/admin/knowledgeBbsManage"; // URL ìˆ˜ì •
    }

    @PostMapping("/deleteKnowledgeBbsCheck")
    public String deleteKnowledgeBbsCheck(@RequestParam(value = "bbsNoList", required = false) List<Integer> bbsNoList,
                                          RedirectAttributes ra) {
        if (bbsNoList == null || bbsNoList.isEmpty()) {
            ra.addFlashAttribute("message", "ì„ íƒëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.");
            return "redirect:/admin/knowledgeBbsManage"; // URL ìˆ˜ì •
        }
        int result = knowledgeService.deleteKnowledgeBbsCheck(bbsNoList);
        ra.addFlashAttribute("message", "ì´ " + result + "ê±´ì˜ ì§€ì‹ê³µìœ  ê²Œì‹œê¸€ì´ ì¼ê´„ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
        return "redirect:/admin/knowledgeBbsManage"; // URL ìˆ˜ì •
    }

    // ==================== ğŸ“š ìŠ¤í„°ë”” ê²Œì‹œíŒ ì¡°íšŒ ê¸°ëŠ¥ ì¶”ê°€ ====================

    @GetMapping("/studyBbsManage")
    public String studyBbsManage(@RequestParam(value = "currentPage", defaultValue = "1") int currentPage, Model model) {
        int listCount = studyService.selectListCount();
        Pagination pageInfo = adminService.getPagination(currentPage, listCount);
        List<StudyBbs> studyBbsList = studyService.selectList(currentPage);
        model.addAttribute("studyBbsList", studyBbsList);
        model.addAttribute("pageInfo", pageInfo);
        model.addAttribute("boardName", "ìŠ¤í„°ë”” ëª¨ì§‘ ê²Œì‹œíŒ");
        model.addAttribute("boardCode", "study");
        return "admin/studyBbsManage";
    }
    
    @GetMapping("/deleteStudyBbs")
    public String deleteStudyBbs(@RequestParam("studyNo") int studyNo, RedirectAttributes ra) {
        int result = studyService.deleteStudyBbs(studyNo);
        ra.addFlashAttribute("message",
                result > 0 ? studyNo + "ë²ˆ ìŠ¤í„°ë””ëª¨ì§‘ ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤." : "ìŠ¤í„°ë”” ê²Œì‹œê¸€ ì‚­ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        return "redirect:/admin/studyBbsManage"; // URL ìˆ˜ì •
    }

    @PostMapping("/deleteStudyBbsCheck")
    public String deleteStudyBbsCheck(@RequestParam(value = "bbsNoList", required = false) List<Integer> bbsNoList,
                                      RedirectAttributes ra) {
        if (bbsNoList == null || bbsNoList.isEmpty()) {
            ra.addFlashAttribute("message", "ì„ íƒëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.");
            return "redirect:/admin/studyBbsManage"; // URL ìˆ˜ì •
        }
        int result = studyService.deleteStudyBbsCheck(bbsNoList);
        ra.addFlashAttribute("message", "ì´ " + result + "ê±´ì˜ ìŠ¤í„°ë””ëª¨ì§‘ ê²Œì‹œê¸€ì´ ì¼ê´„ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
        return "redirect:/admin/studyBbsManage"; // URL ìˆ˜ì •
    }

    
    // ==================== ğŸ“£ ê³µì§€ì‚¬í•­ ê²Œì‹œíŒ ì¡°íšŒ ê¸°ëŠ¥ ì¶”ê°€ ====================

    @GetMapping("/noticeBbsManage")
    public String noticeBbsManage(@RequestParam(value = "currentPage", defaultValue = "1") int currentPage, Model model) {
        int listCount = noticeService.selectListCount();
        Pagination pageInfo = adminService.getPagination(currentPage, listCount);
        List<NoticeBbs> noticeBbsList = noticeService.selectList(currentPage);
        model.addAttribute("noticeBbsList", noticeBbsList);
        model.addAttribute("pageInfo", pageInfo);
        model.addAttribute("boardName", "ê³µì§€ì‚¬í•­ ê²Œì‹œíŒ");
        model.addAttribute("boardCode", "notice");
        return "admin/noticeBbsManage";
    }
    
    @GetMapping("/deleteNoticeBbs")
    public String deleteNoticeBbs(@RequestParam("noticeNo") int noticeNo, RedirectAttributes ra) {
        int result = noticeService.deleteNoticeBbs(noticeNo);
        ra.addFlashAttribute("message",
                result > 0 ? noticeNo + "ë²ˆ ê³µì§€ì‚¬í•­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤." : "ê³µì§€ì‚¬í•­ ì‚­ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        return "redirect:/admin/noticeBbsManage"; // URL ìˆ˜ì •
    }

    @PostMapping("/deleteNoticeBbsCheck")
    public String deleteNoticeBbsCheck(@RequestParam(value = "bbsNoList", required = false) List<Integer> bbsNoList,
                                       RedirectAttributes ra) {
        if (bbsNoList == null || bbsNoList.isEmpty()) {
            ra.addFlashAttribute("message", "ì„ íƒëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.");
            return "redirect:/admin/noticeBbsManage"; // URL ìˆ˜ì •
        }
        int result = noticeService.deleteNoticeBbsCheck(bbsNoList);
        ra.addFlashAttribute("message", "ì´ " + result + "ê±´ì˜ ê³µì§€ì‚¬í•­ì´ ì¼ê´„ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
        return "redirect:/admin/noticeBbsManage"; // URL ìˆ˜ì •
    }
}