<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>

<!DOCTYPE html>

<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê´€ë¦¬ì - ì§€ì‹ì¸ ê²Œì‹œíŒ ê´€ë¦¬</title>
    <link rel="stylesheet" href="<c:url value="/resources/css/adminStyle.css" />">
    <style>
        /* ğŸ’¡ ìŠ¤íƒ€ì¼ì€ noticeManage.jspì™€ ë™ì¼í•©ë‹ˆë‹¤ */
        .pagination-container {
            display: flex;
            justify-content: center; 
            padding: 20px 0;
            gap: 5px;
        }
        .pagination-container a, .pagination-container span {
            padding: 8px 12px;
            text-decoration: none;
            color: #333;
            border: 1px solid #ddd; 
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        .pagination-container a:hover {
            background-color: #f0f0f0;
        }
        .pagination-container .active {
            background-color: #5a5ce8;
            color: white;
            border-color: #5a5ce8; 
        }
        .status-text.deleted { 
            color: red; 
            font-weight: bold; 
        }
        /* [ì¶”ê°€] ì‚­ì œëœ ê²Œì‹œê¸€ í–‰ ìŠ¤íƒ€ì¼ */
        .deleted-post { 
            background-color: #f8f8f8;
            color: #999; 
        }
        .deleted-post a, .deleted-post .status-text { 
            color: #999 !important;
        }
    </style>
</head>
<body>
    
    <header>
        <div class="logo">
            <img src="<c:url value="/resources/images/logo1.PNG" />" width="80">
            ê´€ë¦¬ì í˜ì´ì§€
        </div>
    </header>

    <div class="layout">
        <%-- âœ… ì‚¬ì´ë“œë°”: ì§€ì‹ì¸ ê²Œì‹œíŒ í™œì„±í™” --%>
        <aside class="sidebar">
            <ul>
                <li><a href="<c:url value="/admin/dashboard" />">ğŸ  ëŒ€ì‹œë³´ë“œ</a></li>
                <li><a href="<c:url value="/admin/member" />">ğŸ‘¥ íšŒì› ê´€ë¦¬</a></li>

                <li id="postManageMenu" class="menu-open">
                    <a href="javascript:void(0);" onclick="toggleSubmenu('postManageMenu')">ğŸ“ ê²Œì‹œê¸€ ê´€ë¦¬</a>
                    
                    <ul class="submenu">
                        <li><a href="<c:url value="/admin/freeBbsManage" />">ììœ  ê²Œì‹œíŒ</a></li>
                        <li><a href="<c:url value="/admin/infoBbsManage" />">ì •ë³´ ê³µìœ  ê²Œì‹œíŒ</a></li>
                        <li><a href="<c:url value="/admin/itBbsManage" />">IT ë‰´ìŠ¤ ê²Œì‹œíŒ</a></li>
                        <li><a href="<c:url value="/admin/noticeBbsManage" />">ê³µì§€ì‚¬í•­ ê²Œì‹œíŒ</a></li>
		                <li><a href="<c:url value="/admin/studyBbsManage" />">ìŠ¤í„°ë”” ê²Œì‹œíŒ</a></li>
		                <%-- [ìˆ˜ì •] í˜„ì¬ í˜ì´ì§€ í™œì„±í™” --%>
                        <li class="sub-active"><a href="<c:url value="/admin/knowledgeBbsManage" />" class="sub-active">ì§€ì‹ì¸ ê²Œì‹œíŒ</a></li>
                    </ul>
                </li>
                
                <li><a href="<c:url value="/admin/reply" />">ğŸ’¬ ëŒ“ê¸€ ê´€ë¦¬</a></li>
                <li><a href="<c:url value="/admin/stats" />">ğŸ“Š í†µê³„</a></li>
                <li><a href="<c:url value="/admin/logout" />">ğŸšª ë¡œê·¸ì•„ì›ƒ</a></li>
            </ul>
        </aside>

        <%-- âœ… ë©”ì¸ ì»¨í…ì¸  --%>
        <main>
            <h1>ğŸ“ ì§€ì‹ì¸ ê²Œì‹œê¸€ ê´€ë¦¬</h1>
            <p>ì§€ì‹ì¸ ê²Œì‹œíŒì— ë“±ë¡ëœ ê²Œì‹œê¸€ ëª©ë¡ì„ í™•ì¸í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

            <form id="bulkDeleteForm" action="<c:url value="/admin/deleteKnowledgeBbsCheck" />" method="POST" style="display:none;"></form>

            <%-- [ìˆ˜ì •] ì¼ê´„ ì‚­ì œ ë²„íŠ¼ ìœ„ì¹˜ ë° ë¬¸êµ¬ í†µì¼ --%>
            <div style="display:flex; justify-content:flex-end; margin-bottom:10px;">
                <button class="btn btn-danger" onclick="deleteCheckedPosts()">ì„ íƒ ê²Œì‹œê¸€ ì¼ê´„ ì‚­ì œ</button>
            </div>

            <form action="<c:url value="/admin/deleteKnowledgeBbsCheck" />" method="POST" id="postManageForm">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="width: 5%;">
                                <input type="checkbox" id="selectAllCheckboxPost">
                            </th>
                            <th style="width: 10%;">ë²ˆí˜¸</th>
                            <th>ì œëª©</th>
                            <th style="width: 15%;">ì‘ì„±ì(ë‹‰ë„¤ì„)</th>
                            <th style="width: 10%;">ì¹´í…Œê³ ë¦¬</th>
                            <th style="width: 15%;">ì‘ì„±ì¼</th>
                            <th style="width: 10%;">ìƒíƒœ</th>
                            <th style="width: 10%;">ìƒì„¸</th>
                        </tr>
                    </thead>
                    <tbody>
                        <c:choose>
                            <c:when test="${!empty knowledgeBbsList}">
                                <c:forEach var="post" items="${knowledgeBbsList}">
                                    <tr class="${post.knowledgeDeleteStatus eq 'Y' ? 'deleted-post' : ''}">
                                        <td>
                                            <input type="checkbox" class="itemCheckboxPost" name="bbsNoList" value="${post.knowledgeNo}"
                                                   <c:if test="${post.knowledgeDeleteStatus eq 'Y'}">disabled</c:if>>
                                        </td>
                                        <td>${post.knowledgeNo}</td>
                                        <td class="text-left">
                                            <c:choose>
                                                <c:when test="${post.knowledgeDeleteStatus eq 'Y'}">
                                                    <span class="status-text deleted">[ì‚­ì œë¨]</span> ${post.knowledgeTitle}
                                                </c:when>
                                                <c:otherwise>
                                                    <a href="<c:url value="/knowledge/detail?no=${post.knowledgeNo}" />" class="title-link" target="_blank">
                                                        ${post.knowledgeTitle}
                                                    </a>
                                                </c:otherwise>
                                            </c:choose>
                                        </td>
                                        <td>${post.memberNick}</td>
                                        <td>${post.knowledgeCategory}</td>
                                        <td><fmt:formatDate value="${post.knowledgeCreateDate}" pattern="yyyy.MM.dd" /></td>
                                        <td>
                                            <span class="status-text ${post.knowledgeDeleteStatus eq 'Y' ? 'deleted' : 'active'}">
                                                ${post.knowledgeDeleteStatus eq 'Y' ? '[ë¹„í™œì„±]' : '[í™œì„±]'}
                                            </span>
                                        </td>
                                        <td>
                                            <button class="btn btn-sm btn-danger" 
                                                    onclick="deleteSinglePost(${post.knowledgeNo})"
                                                    <c:if test="${post.knowledgeDeleteStatus eq 'Y'}">disabled</c:if>>
                                                ì‚­ì œ
                                            </button>
                                        </td>
                                    </tr>
                                </c:forEach>
                            </c:when>
                            <c:otherwise>
                                <tr>
                                    <td colspan="8">ì¡°íšŒëœ ì§€ì‹ì¸ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</td>
                                </tr>
                            </c:otherwise>
                        </c:choose>
                    </tbody>
                </table>
            </form>

            <div class="pagination-container">
                <c:set var="pi" value="${pageInfo}"/>
                <c:set var="pageLinkUrl" value="/admin/knowledgeBbsManage" />
                
                <c:choose><c:when test="${pi.currentPage le 1}"><span class="disabled">&lt;&lt;</span></c:when><c:otherwise><a href="<c:url value="${pageLinkUrl}" />?currentPage=1">&lt;&lt;</a></c:otherwise></c:choose>
                <c:choose><c:when test="${pi.currentPage le 1}"><span class="disabled">&lt;</span></c:when><c:otherwise><a href="<c:url value="${pageLinkUrl}" />?currentPage=${pi.currentPage - 1}">&lt;</a></c:otherwise></c:choose>
                
                <c:forEach begin="${pi.startPage}" end="${pi.endPage}" var="p">
                    <c:choose><c:when test="${pi.currentPage eq p}"><span class="active">${p}</span></c:when><c:otherwise><a href="<c:url value="${pageLinkUrl}" />?currentPage=${p}">${p}</a></c:otherwise></c:choose>
                </c:forEach>
                
                <c:choose><c:when test="${pi.currentPage eq pi.maxPage || pi.maxPage eq 0}"><span class="disabled">&gt;</span></c:when><c:otherwise><a href="<c:url value="${pageLinkUrl}" />?currentPage=${pi.currentPage + 1}">&gt;</a></c:otherwise></c:choose>
                <c:choose><c:when test="${pi.currentPage eq pi.maxPage || pi.maxPage eq 0}"><span class="disabled">&gt;&gt;</span></c:when><c:otherwise><a href="<c:url value="${pageLinkUrl}" />?currentPage=${pi.maxPage}">&gt;&gt;</a></c:otherwise></c:choose>
            </div>
        </main>
    </div>

    <footer>â“’ 2025 IT GO UP GO. All Rights Reserved.</footer>

    <script>
        // ì‚¬ì´ë“œë°” í† ê¸€ í•¨ìˆ˜ (ìƒˆë¡œìš´ í…œí”Œë¦¿ì— ë§ê²Œ ì¶”ê°€)
        function toggleSubmenu(menuId) { 
            document.getElementById(menuId).classList.toggle('menu-open'); 
        }
        
        // [ì œê±°] validateSearch í•¨ìˆ˜ ì œê±°ë¨

        function deleteCheckedPosts() {
            // ì‚­ì œë˜ì§€ ì•Šì€ (disabledê°€ ì•„ë‹Œ) ê²Œì‹œê¸€ì˜ ì²´í¬ë°•ìŠ¤ë§Œ ì„ íƒ
            const selectedCheckboxes = document.querySelectorAll('.itemCheckboxPost:checked:not(:disabled)');

            if (selectedCheckboxes.length === 0) {
                alert("ì‚­ì œí•  ê²Œì‹œê¸€ì„ í•˜ë‚˜ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”. (ì´ë¯¸ ì‚­ì œëœ ê²Œì‹œê¸€ ì œì™¸)"); 
                return; 
            }

            if (confirm(`ì„ íƒëœ ê²Œì‹œê¸€ ${selectedCheckboxes.length}ê°œë¥¼ ì •ë§ë¡œ ë¹„í™œì„±í™”(ì‚­ì œ ì²˜ë¦¬)í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                const formElement = document.getElementById('postManageForm');
                
                // ê¸°ì¡´ íˆë“  ì¸í’‹ ì œê±°
                formElement.querySelectorAll('input[name="bbsNoList"]').forEach(input => input.remove());
                selectedCheckboxes.forEach(checkbox => {
                    const hiddenInput = document.createElement('input');
                    hiddenInput.type = 'hidden';
                    hiddenInput.name = 'bbsNoList'; // Controllerì˜ @RequestParam ì´ë¦„ê³¼ ì¼ì¹˜
                    hiddenInput.value = checkbox.value;
                    formElement.appendChild(hiddenInput);
                });
                formElement.submit(); 
            }
        }

        // ë‹¨ì¼ ê²Œì‹œê¸€ ì‚­ì œ í•¨ìˆ˜
        function deleteSinglePost(knowledgeNo) {
            if (confirm(`${knowledgeNo}ë²ˆ ê²Œì‹œê¸€ì„ ì •ë§ ì‚­ì œ(ë¹„í™œì„±í™”) ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                location.href = "<c:url value="/admin/deleteKnowledgeBbs" />?knowledgeNo=" + knowledgeNo;
            }
        }

        document.addEventListener('DOMContentLoaded', (event) => {
            const selectAllCheckbox = document.getElementById('selectAllCheckboxPost');
            // ì‚­ì œëœ ê²Œì‹œê¸€ ì œì™¸í•œ ì²´í¬ë°•ìŠ¤ë§Œ ëŒ€ìƒìœ¼ë¡œ í•¨
            const itemCheckboxes = document.querySelectorAll('.itemCheckboxPost:not(:disabled)');
            
            if (selectAllCheckbox) {
                selectAllCheckbox.addEventListener('change', function() {
                    itemCheckboxes.forEach(checkbox => {
                        checkbox.checked = this.checked;
                    });
                });
            }
            
            itemCheckboxes.forEach(checkbox => { 
                checkbox.addEventListener('change', () => { 
                    const checkedItems = document.querySelectorAll('.itemCheckboxPost:checked:not(:disabled)').length;
                    const totalItems = itemCheckboxes.length;
                    
                    if (!checkbox.checked) {
                        if (selectAllCheckbox) selectAllCheckbox.checked = false;
                    } else if (checkedItems === totalItems) {
                        if (selectAllCheckbox) selectAllCheckbox.checked = true;
                    }
                });
            });

            // ê²Œì‹œê¸€ ê´€ë¦¬ ë©”ë‰´ ì—´ë¦° ìƒíƒœ ìœ ì§€ (ìƒˆë¡œìš´ í…œí”Œë¦¿ì— ë§ê²Œ ì¶”ê°€)
            const postManageMenu = document.getElementById('postManageMenu');
            if (postManageMenu && !postManageMenu.classList.contains('menu-open')) {
                 postManageMenu.classList.add('menu-open');
            }
        });
    </script>

</body>
</html>