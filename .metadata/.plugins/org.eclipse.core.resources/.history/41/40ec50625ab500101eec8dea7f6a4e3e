<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê²Œì‹œê¸€ ê´€ë¦¬</title>
  <%-- ğŸ’¡ CSS íŒŒì¼ ê²½ë¡œ í™•ì¸ (memberManage.jspì™€ ë™ì¼í•œ ê²½ë¡œ ì‚¬ìš©) --%>
  <link rel="stylesheet" href="<c:url value="/resources/css/adminStyle.css" />">
  <style>
    /* ğŸ’¡ [ì¶”ê°€] í˜ì´ì§•ë°” ìŠ¤íƒ€ì¼: UIë¥¼ ê¹”ë”í•˜ê²Œ ìœ ì§€í•˜ê¸° ìœ„í•œ í•„ìˆ˜ ìŠ¤íƒ€ì¼ */
    .pagination-container {
        display: flex;
        justify-content: center;
        padding: 20px 0;
        gap: 5px;
    }
    .pagination-container a, .pagination-container span {
        padding: 8px 12px;
        text-decoration: none;
        color: #333;
        border: 1px solid #ddd;
        border-radius: 4px;
        transition: background-color 0.3s;
    }
    .pagination-container a:hover {
        background-color: #f0f0f0;
    }
    .pagination-container .active {
        background-color: #5a5ce8; /* ì‚¬ìš©ìë‹˜ì˜ ê¸°ì¡´ ë²„íŠ¼ ìƒ‰ìƒ */
        color: white;
        border: 1px solid #5a5ce8;
        font-weight: bold;
    }
    .list-table thead th:nth-child(5) { 
        width: 30%; /* ì œëª© ì»¬ëŸ¼ ë„ˆë¹„ í™•ë³´ */
        text-align: left;
        padding-left: 15px;
    }
    .list-table tbody td:nth-child(5) { 
        text-align: left;
        padding-left: 15px;
    }
  </style>
</head>
<body>

  <%-- ğŸ’¡ ì „ì²´ í˜ì´ì§€ ë˜í¼ --%>
  <div class="wrap">
    <%-- ğŸ’¡ ê´€ë¦¬ì í˜ì´ì§€ ì‚¬ì´ë“œë°”/í—¤ë” ë“±ì´ í¬í•¨ë˜ëŠ” ì˜ì—­ (ì—¬ê¸°ì„œëŠ” ìƒëµ) --%>
    
    <div class="content">
      <h1>ê²Œì‹œê¸€ ê´€ë¦¬</h1>

      <%-- 1. ê²Œì‹œê¸€ ê²€ìƒ‰ ì˜ì—­ --%>
      <div class="search-area">
        <form action="<c:url value="/admin/postManage" />" method="get" id="searchForm">
          <%-- ê²€ìƒ‰ ê¸°ì¤€ --%>
          <select name="searchType" id="searchType">
            <option value="title">ì œëª©</option>
            <option value="content">ë‚´ìš©</option>
            <option value="author">ì‘ì„±ì</option>
            <option value="boardType">ê²Œì‹œíŒ ì¢…ë¥˜</option>
          </select>
          
          <%-- ê²€ìƒ‰ì–´ ì…ë ¥ --%>
          <input type="text" name="keyword" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" value="${param.keyword}">
          
          <%-- ê²€ìƒ‰ ë²„íŠ¼ --%>
          <button type="submit" class="btn search-btn">ê²€ìƒ‰</button>
        </form>
      </div>

      <%-- 2. ì „ì²´ ê²Œì‹œê¸€ ì •ë³´ ë° ì¼ê´„ ì‚­ì œ ë²„íŠ¼ ì˜ì—­ --%>
      <div class="top-info-area">
        <p>
          ì´ ê²Œì‹œê¸€ ìˆ˜: 
          <%-- PageInfo ê°ì²´ì˜ listCount ê°’ì„ ì‚¬ìš©í•œë‹¤ê³  ê°€ì • --%>
          <strong><c:out value="${pi.listCount}" default="0"/></strong> ê±´
        </p>
        
        <%-- ì¼ê´„ ì‚­ì œ ë²„íŠ¼ --%>
        <button type="button" class="btn delete-btn" onclick="deletePost('<c:url value="/admin/deletePost" />');">
          <i class="fas fa-trash-alt"></i> ì„ íƒ ê²Œì‹œê¸€ ì‚­ì œ
        </button>
      </div>

      <%-- 3. ë°ì´í„° í‘œì‹œ í…Œì´ë¸” --%>
      <table class="list-table">
        <thead>
          <tr>
            <th>
              <input type="checkbox" id="selectAllCheckboxPost">
            </th>
            <th>ë²ˆí˜¸</th>
            <th>ê²Œì‹œê¸€ ë²ˆí˜¸</th>
            <th>ê²Œì‹œíŒ ì¢…ë¥˜</th>
            <th>ì œëª©</th>
            <th>ì‘ì„±ì</th>
            <th>ì‘ì„±ì¼</th>
            <th>ì¡°íšŒìˆ˜</th>
            <th>ìƒíƒœ</th>
          </tr>
        </thead>
        <tbody>
          <%-- ê²Œì‹œê¸€ ëª©ë¡ì´ ìˆì„ ê²½ìš° --%>
          <c:choose>
            <c:when test="${not empty postList}">
              <%-- postListë¥¼ ìˆœíšŒí•˜ë©° ë°ì´í„° ì¶œë ¥ (ê²Œì‹œê¸€ ë²ˆí˜¸ëŠ” ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ê°€ì •) --%>
              <c:forEach var="post" items="${postList}" varStatus="status">
                <tr>
                  <td>
                    <%-- ê²Œì‹œê¸€ ë²ˆí˜¸ë¥¼ valueë¡œ ì‚¬ìš© --%>
                    <input type="checkbox" class="itemCheckboxPost" name="postNo" value="${post.postNo}">
                  </td>
                  <%-- ëª©ë¡ì˜ ìˆœì„œ ë²ˆí˜¸ (listCount - offset - index) --%>
                  <td><c:out value="${pi.listCount - pi.startList - status.index}" /></td>
                  <%-- ê²Œì‹œê¸€ ë²ˆí˜¸ --%>
                  <td><c:out value="${post.postNo}" /></td>
                  
                  <%-- ğŸ’¡ ê²Œì‹œíŒ ì¢…ë¥˜ í‘œì‹œ (Controllerì—ì„œ post ê°ì²´ì— boardType í•„ë“œë¥¼ ì¶”ê°€í–ˆë‹¤ê³  ê°€ì •) --%>
                  <td><c:out value="${post.boardType}" default="ììœ "/></td>
                  
                  <%-- ì œëª© (í´ë¦­ ì‹œ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™) --%>
                  <td>
                    <a href="<c:url value="/bbs/detail/${post.postNo}" />"><c:out value="${post.postTitle}" /></a>
                  </td>
                  
                  <%-- ì‘ì„±ì ID (memberIdê°€ post ê°ì²´ì— í¬í•¨ë˜ì–´ ìˆë‹¤ê³  ê°€ì •) --%>
                  <td><c:out value="${post.memberId}" default="íƒˆí‡´íšŒì›"/></td>
                  
                  <%-- ì‘ì„±ì¼ (ë‚ ì§œ í¬ë§· ì ìš©) --%>
                  <td><fmt:formatDate value="${post.postCreateDate}" pattern="yyyy.MM.dd"/></td>
                  
                  <%-- ì¡°íšŒìˆ˜ --%>
                  <td><c:out value="${post.postView}" default="0"/></td>
                  
                  <%-- ìƒíƒœ (postDeleteStatusê°€ 'Y'ë©´ ì‚­ì œë¨, 'N'ì´ë©´ ì •ìƒìœ¼ë¡œ ê°€ì •) --%>
                  <td>
                    <c:choose>
                      <c:when test="${post.postDeleteStatus eq 'Y'}">
                        <span style="color: red; font-weight: bold;">[ì‚­ì œë¨]</span>
                      </c:when>
                      <c:otherwise>
                        <span style="color: green;">ì •ìƒ</span>
                      </c:otherwise>
                    </c:choose>
                  </td>
                </tr>
              </c:forEach>
            </c:when>
            
            <%-- ê²Œì‹œê¸€ ëª©ë¡ì´ ì—†ì„ ê²½ìš° --%>
            <c:otherwise>
              <tr>
                <td colspan="9" style="text-align: center; padding: 20px;">
                  ê²€ìƒ‰ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
                </td>
              </tr>
            </c:otherwise>
          </c:choose>
        </tbody>
      </table>

      <%-- 4. ì¼ê´„ ì‚­ì œ ì²˜ë¦¬ë¥¼ ìœ„í•œ ìˆ¨ê²¨ì§„ í¼ (memberManage.jspì™€ ë™ì¼í•œ êµ¬ì¡°) --%>
      <form action="" method="post" id="deleteFormPost" style="display: none;">
        <%-- Controllerì—ì„œ postNoListë¼ëŠ” ì´ë¦„ìœ¼ë¡œ List<Integer>ë¥¼ ë°›ì„ ì˜ˆì •ì´ë¼ê³  ê°€ì • --%>
      </form>

      <%-- 5. í˜ì´ì§•ë°” ì˜ì—­ (PageInfo ê°ì²´ì˜ ê°’ì„ ì‚¬ìš©í•œë‹¤ê³  ê°€ì •) --%>
      <div class="pagination-container">
        
        <%-- ë§¨ ì²˜ìŒìœ¼ë¡œ (1í˜ì´ì§€ë¡œ ì´ë™) --%>
        <c:choose>
          <c:when test="${pi.currentPage eq 1}">
            <span>&lt;&lt;</span>
          </c:when>
          <c:otherwise>
            <a href="<c:url value="/admin/postManage" />?currentPage=1&searchType=${param.searchType}&keyword=${param.keyword}">&lt;&lt;</a>
          </c:otherwise>
        </c:choose>

        <%-- ì´ì „ í˜ì´ì§€ë¡œ (startPage - 1) --%>
        <c:choose>
          <c:when test="${pi.currentPage eq 1}">
            <span>&lt;</span>
          </c:when>
          <c:otherwise>
            <a href="<c:url value="/admin/postManage" />?currentPage=${pi.currentPage - 1}&searchType=${param.searchType}&keyword=${param.keyword}">&lt;</a>
          </c:otherwise>
        </c:choose>

        <%-- í˜ì´ì§€ ë²ˆí˜¸ ëª©ë¡ --%>
        <c:forEach var="p" begin="${pi.startPage}" end="${pi.endPage}">
          <c:choose>
            <%-- í˜„ì¬ í˜ì´ì§€ì¸ ê²½ìš° --%>
            <c:when test="${p eq pi.currentPage}">
              <span class="active"><c:out value="${p}" /></span>
            </c:when>
            <%-- ë‹¤ë¥¸ í˜ì´ì§€ì¸ ê²½ìš° --%>
            <c:otherwise>
              <a href="<c:url value="/admin/postManage" />?currentPage=${p}&searchType=${param.searchType}&keyword=${param.keyword}"><c:out value="${p}" /></a>
            </c:otherwise>
          </c:choose>
        </c:forEach>
        
        <%-- ë‹¤ìŒ í˜ì´ì§€ë¡œ (endPage + 1 ë˜ëŠ” maxPage) --%>
        <c:choose>
          <c:when test="${pi.currentPage eq pi.maxPage}">
            <span>&gt;</span>
          </c:when>
          <c:otherwise>
            <a href="<c:url value="/admin/postManage" />?currentPage=${pi.currentPage + 1}&searchType=${param.searchType}&keyword=${param.keyword}">&gt;</a>
          </c:otherwise>
        </c:choose>

        <%-- ë§¨ ëìœ¼ë¡œ (maxPageë¡œ ì´ë™) --%>
        <c:choose>
          <c:when test="${pi.currentPage eq pi.maxPage}">
            <span>&gt;&gt;</span>
          </c:when>
          <c:otherwise>
            <a href="<c:url value="/admin/postManage" />?currentPage=${pi.maxPage}&searchType=${param.searchType}&keyword=${param.keyword}">&gt;&gt;</a>
          </c:otherwise>
        </c:choose>
      </div>

    </div> <%-- end of content --%>
  </div> <%-- end of wrap --%>

  <script>
    // 1. ê²Œì‹œê¸€ ì¼ê´„ ì‚­ì œ ê¸°ëŠ¥ í•¨ìˆ˜
    function deletePost(url) {
        const form = document.getElementById('deleteFormPost');
        const selectedCheckboxes = document.querySelectorAll('.itemCheckboxPost:checked');

        if (selectedCheckboxes.length === 0) {
            // ì‚¬ìš©ì ì •ì˜ ëª¨ë‹¬ ë˜ëŠ” ë©”ì‹œì§€ ë°•ìŠ¤ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
            // window.alert("ì„ íƒëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤."); 
            console.warn("ì„ íƒëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤. (TODO: ì‚¬ìš©ì ì •ì˜ ëª¨ë‹¬ë¡œ ë³€ê²½)");
            // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤„ UI ë¡œì§ì´ í•„ìš”
            alert("ì„ íƒëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤."); 
            return;
        }

        // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì‚¬ìš©ì ì •ì˜ ëª¨ë‹¬ ë˜ëŠ” ë©”ì‹œì§€ ë°•ìŠ¤ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
        // if (!window.confirm(`ì„ íƒëœ ê²Œì‹œê¸€ ${selectedCheckboxes.length}ê°œë¥¼ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) { 
        //     return;
        // }
        // ì„ì‹œë¡œ console.logë¡œ ëŒ€ì²´í•˜ê±°ë‚˜, ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ì»¤ìŠ¤í…€ ëª¨ë‹¬ ì‚¬ìš©
        console.log(`ì„ íƒëœ ê²Œì‹œê¸€ ${selectedCheckboxes.length}ê°œë¥¼ ì‚­ì œ ìš”ì²­í•©ë‹ˆë‹¤.`);
        if (!confirm(`ì„ íƒëœ ê²Œì‹œê¸€ ${selectedCheckboxes.length}ê°œë¥¼ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) { 
             return;
        }

        form.action = url; // POST ìš”ì²­ URL ì„¤ì •
        
        // ì´ì „ì— ì¶”ê°€ëœ hidden inputì´ ìˆë‹¤ë©´ ì œê±°
        while (form.firstChild) {
            form.removeChild(form.firstChild);
        }

        // ì„ íƒëœ ì²´í¬ë°•ìŠ¤ì˜ valueë¥¼ hidden inputìœ¼ë¡œ í¼ì— ì¶”ê°€í•˜ì—¬ ì „ì†¡
        selectedCheckboxes.forEach(checkbox => {
            const hiddenInput = document.createElement('input');
            hiddenInput.type = 'hidden';
            hiddenInput.name = 'postNoList'; // Controllerì˜ @RequestParam ì´ë¦„ê³¼ ì¼ì¹˜
            hiddenInput.value = checkbox.value;
            form.appendChild(hiddenInput);
        });
        
        form.submit(); // POST ìš”ì²­ ì „ì†¡
    }

    // 2. ì²´í¬ë°•ìŠ¤ ì „ì²´ ì„ íƒ/í•´ì œ ê¸°ëŠ¥
    document.addEventListener('DOMContentLoaded', (event) => {
        const selectAllCheckbox = document.getElementById('selectAllCheckboxPost');
        const itemCheckboxes = document.querySelectorAll('.itemCheckboxPost');

        selectAllCheckbox.addEventListener('change', function() {
            itemCheckboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
        });
        
        itemCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                const checkedItems = document.querySelectorAll('.itemCheckboxPost:checked').length;
                if (!checkbox.checked) {
                    // í•˜ë‚˜ë¼ë„ í•´ì œë˜ë©´ ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ í•´ì œ
                    selectAllCheckbox.checked = false;
                } else if (checkedItems === itemCheckboxes.length) {
                    // ëª¨ë“  ê°œë³„ í•­ëª©ì´ ì„ íƒë˜ë©´ ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ì„ íƒ
                    selectAllCheckbox.checked = true;
                }
            });
        });
    });
 </script>
</body>
</html>
