<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %> 
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì •ë³´ ê³µìœ  ê²Œì‹œíŒ ê´€ë¦¬</title>

    <link rel="stylesheet" href="<c:url value="/resources/css/adminStyle.css" />">
    <style>
        /* ğŸ’¡ [CSS ì¶”ê°€] ì‚­ì œëœ ê²Œì‹œê¸€ í–‰ ìŠ¤íƒ€ì¼ */
        .deleted-post {
            background-color: #f8f8f8; /* ë°°ê²½ìƒ‰ì„ ì—°í•œ íšŒìƒ‰ìœ¼ë¡œ */
            color: #999; /* í°íŠ¸ ìƒ‰ìƒì„ íšŒìƒ‰ìœ¼ë¡œ */
            text-decoration: line-through; /* ì·¨ì†Œì„  */
        }
        /* ì‚­ì œëœ ê²Œì‹œê¸€ ë‚´ì˜ ë§í¬, í…ìŠ¤íŠ¸ ìƒ‰ìƒë„ íšŒìƒ‰ìœ¼ë¡œ í†µì¼ */
        .deleted-post a, .deleted-post .text-danger, .deleted-post .text-secondary {
            color: #999 !important;
        }
    </style>
</head>
<body>
    
    <header>
        <div class="logo">
            <img src="<c:url value="/resources/images/logo1.PNG" />" width="80">
            ê´€ë¦¬ì í˜ì´ì§€
        </div>
    </header>

    <div class="layout">
        <%-- âœ… ì‚¬ì´ë“œë°”: ì •ë³´ ê³µìœ  ê²Œì‹œíŒ í™œì„±í™” --%>
        <aside class="sidebar">
            <ul>
                <li><a href="<c:url value="/admin/dashboard" />">ğŸ  ëŒ€ì‹œë³´ë“œ</a></li>
                <li><a href="<c:url value="/admin/member" />">ğŸ‘¥ íšŒì› ê´€ë¦¬</a></li>

                <%-- 'ê²Œì‹œê¸€ ê´€ë¦¬' ë©”ë‰´ í™œì„±í™” --%>
                <li id="postManageMenu" class="menu-open">
                    <a href="javascript:void(0);" onclick="toggleSubmenu('postManageMenu')">ğŸ“ ê²Œì‹œê¸€ ê´€ë¦¬</a>
                    <ul class="submenu">
                        <li><a href="<c:url value="/admin/post/noticeList" />">ê³µì§€ì‚¬í•­ ê´€ë¦¬</a></li>
                        <li><a href="<c:url value="/admin/post/freeList" />">ììœ  ê²Œì‹œíŒ ê´€ë¦¬</a></li>
                        <%-- í˜„ì¬ í˜ì´ì§€: ì •ë³´ ê³µìœ  ê²Œì‹œíŒ í™œì„±í™” --%>
                        <li><a href="<c:url value="/admin/post/infoList" />" class="active">ì •ë³´ ê³µìœ  ê²Œì‹œíŒ ê´€ë¦¬</a></li>
                        <li><a href="<c:url value="/admin/post/itList" />">IT ë‰´ìŠ¤ ê´€ë¦¬</a></li>
                        <li><a href="<c:url value="/admin/post/knowledgeList" />">ì§€ì‹ ê³µìœ  ê´€ë¦¬</a></li>
                    </ul>
                </li>
            </ul>
        </aside>

        <%-- âœ… ë³¸ë¬¸ ë‚´ìš© --%>
        <main class="content">
            <h1 class="page-title">ì •ë³´ ê³µìœ  ê²Œì‹œíŒ ê´€ë¦¬</h1>

            <div class="board-header">
                <span class="total-count">
                    ì´ ê²Œì‹œê¸€ ìˆ˜: <strong>${pageInfo.listCount}</strong>ê°œ
                </span>
                
                <div class="action-buttons">
                    <!-- ì¼ê´„ ì‚­ì œ í¼ (ìˆ¨ê²¨ì§„ í¼) -->
                    <form id="bulkDeleteForm" action="<c:url value="/admin/info/delete" />" method="post" style="display:none;"></form>

                    <button class="btn btn-danger" onclick="bulkDeletePost()">
                        <i class="fas fa-trash-alt"></i> ì„ íƒ ê²Œì‹œê¸€ ì¼ê´„ ì‚­ì œ
                    </button>
                </div>
            </div>

            <table class="data-table">
                <thead>
                    <tr>
                        <th style="width: 5%;">
                            <input type="checkbox" id="selectAllCheckboxPost">
                        </th>
                        <th style="width: 8%;">ë²ˆí˜¸</th>
                        <th style="width: 45%;">ì œëª©</th>
                        <th style="width: 10%;">ì‘ì„±ì</th>
                        <th style="width: 12%;">ì‘ì„±ì¼</th>
                        <th style="width: 8%;">ì¡°íšŒìˆ˜</th>
                        <th style="width: 12%;">ê´€ë¦¬</th>
                    </tr>
                </thead>
                <tbody>
                    <c:choose>
                        <c:when test="${empty bbsList}">
                            <tr>
                                <td colspan="7" class="text-center">ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</td>
                            </tr>
                        </c:when>
                        <c:otherwise>
                            <%-- ê²Œì‹œê¸€ ëª©ë¡ ë°˜ë³µ ì¶œë ¥ --%>
                            <c:forEach var="bbs" items="${bbsList}">
                                <%-- â­ï¸ [ìˆ˜ì •] InfoBbs VO ê°ì²´ ì†ì„± ì‚¬ìš© --%>
                                <tr class="<c:if test="${bbs.infoDeleteStatus eq 'Y'}">deleted-post</c:if>">
                                    <td>
                                        <input type="checkbox" class="itemCheckboxPost" name="bbsNo" value="${bbs.infoNo}"
                                            <c:if test="${bbs.infoDeleteStatus eq 'Y'}">disabled</c:if>>
                                    </td>
                                    <td>${bbs.infoNo}</td>
                                    <td class="text-left">
                                        <%-- â­ï¸ [ìˆ˜ì •] InfoBbs VO ê°ì²´ ì†ì„± ë° URL ì‚¬ìš© --%>
                                        <c:choose>
                                            <c:when test="${bbs.infoDeleteStatus eq 'Y'}">
                                                <span class="text-secondary">${bbs.infoTitle} (ì‚­ì œë¨)</span>
                                            </c:when>
                                            <c:otherwise>
                                                <a href="<c:url value="/info/detail?no=${bbs.infoNo}" />" target="_blank" title="ê²Œì‹œê¸€ ìƒì„¸ ë³´ê¸°">
                                                    ${bbs.infoTitle}
                                                </a>
                                            </c:otherwise>
                                        </c:choose>
                                    </td>
                                    <%-- â­ï¸ [ìˆ˜ì •] ì—ëŸ¬ì˜ ì›ì¸ì´ì—ˆë˜ memberNick ì‚¬ìš© --%>
                                    <td>${bbs.memberNick}</td> 
                                    <td>
                                        <fmt:formatDate value="${bbs.infoCreateDate}" pattern="yy-MM-dd HH:mm"/>
                                    </td>
                                    <td>${bbs.infoView}</td>
                                    <td>
                                        <%-- â­ï¸ [ìˆ˜ì •] ê°œë³„ ì‚­ì œ í•¨ìˆ˜ì— InfoBbs No ì „ë‹¬ --%>
                                        <button class="btn btn-sm btn-delete" 
                                                onclick="deletePost(${bbs.infoNo})"
                                                <c:if test="${bbs.infoDeleteStatus eq 'Y'}">disabled</c:if>>
                                            ì‚­ì œ
                                        </button>
                                    </td>
                                </tr>
                            </c:forEach>
                        </c:otherwise>
                    </c:choose>
                </tbody>
            </table>

            <%-- âœ… í˜ì´ì§€ë„¤ì´ì…˜ ì˜ì—­ --%>
            <div class="pagination">
                <c:set var="pi" value="${pageInfo}"/>
                
                <%-- ë§¨ ì²˜ìŒìœ¼ë¡œ (<<) --%>
                <a href="<c:url value="/admin/post/infoList?currentPage=1" />" 
                   class="page-link <c:if test="${pi.currentPage eq 1}">disabled</c:if>">
                    &lt;&lt;
                </a>
                
                <%-- ì´ì „ í˜ì´ì§€ ê·¸ë£¹ìœ¼ë¡œ (<) --%>
                <a href="<c:url value="/admin/post/infoList?currentPage=${pi.startPage - 1}" />" 
                   class="page-link <c:if test="${pi.currentPage eq 1}">disabled</c:if>">
                    &lt;
                </a>
                
                <%-- í˜ì´ì§€ ë²ˆí˜¸ --%>
                <c:forEach var="p" begin="${pi.startPage}" end="${pi.endPage}">
                    <a href="<c:url value="/admin/post/infoList?currentPage=${p}" />" 
                       class="page-link <c:if test="${pi.currentPage eq p}">active</c:if>">
                        ${p}
                    </a>
                </c:forEach>
                
                <%-- ë‹¤ìŒ í˜ì´ì§€ ê·¸ë£¹ìœ¼ë¡œ (>) --%>
                <a href="<c:url value="/admin/post/infoList?currentPage=${pi.endPage + 1}" />" 
                   class="page-link <c:if test="${pi.currentPage eq pi.maxPage}">disabled</c:if>">
                    &gt;
                </a>
                
                <%-- ë§¨ ëìœ¼ë¡œ (>>) --%>
                <a href="<c:url value="/admin/post/infoList?currentPage=${pi.maxPage}" />" 
                   class="page-link <c:if test="${pi.currentPage eq pi.maxPage}">disabled</c:if>">
                    &gt;&gt;
                </a>
            </div>

        </main>
    </div>

    <%-- âœ… JavaScript: ì‚¬ì´ë“œë°” í† ê¸€, ì‚­ì œ ê¸°ëŠ¥ --%>
    <script>
    /**
     * ì‚¬ì´ë“œë°” ì„œë¸Œë©”ë‰´ í† ê¸€ ê¸°ëŠ¥
     * @param {string} menuId - í† ê¸€í•  ë©”ë‰´ í•­ëª©ì˜ ID
     */
    function toggleSubmenu(menuId) {
        const menu = document.getElementById(menuId);
        menu.classList.toggle('menu-open');
    }

    /**
     * ê°œë³„ ê²Œì‹œê¸€ ì‚­ì œ ì²˜ë¦¬ (ì‹¤ì œë¡œëŠ” ì‚­ì œ ìƒíƒœ UPDATE)
     * @param {number} bbsNo - ì‚­ì œí•  ê²Œì‹œê¸€ ë²ˆí˜¸ (InfoBbs No)
     */
    function deletePost(bbsNo) {
        // â­ï¸ [ìˆ˜ì •] ì‚­ì œ ìš”ì²­ URLì„ /admin/info/deleteë¡œ ë³€ê²½
        const deleteUrl = "<c:url value="/admin/info/delete" />";

        if (confirm(`${bbsNo}ë²ˆ ê²Œì‹œê¸€ì„ ì •ë§ ì‚­ì œ(ë¹„í™œì„±í™”) ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            // íˆë“  í¼ì„ ìƒì„±í•˜ì—¬ POST ìš”ì²­ìœ¼ë¡œ ì‚­ì œ ì²˜ë¦¬
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = deleteUrl;

            // ê²Œì‹œê¸€ ë²ˆí˜¸ë¥¼ ë‹´ì„ hidden input
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'bbsNoList'; // ë‹¨ê±´ ì‚­ì œë„ ë°°ì—´ë¡œ ë°›ë„ë¡ í†µì¼
            input.value = bbsNo;
            form.appendChild(input);

            document.body.appendChild(form);
            form.submit();
        }
    }

    /**
     * ì„ íƒëœ ê²Œì‹œê¸€ ì¼ê´„ ì‚­ì œ ì²˜ë¦¬
     */
    function bulkDeletePost() {
        const selectedCheckboxes = Array.from(document.querySelectorAll('.itemCheckboxPost:checked:not(:disabled)'))
                                      .filter(checkbox => {
                                          // ì‚­ì œ ìƒíƒœê°€ 'Y'ì¸ ê²Œì‹œê¸€ì€ ì²´í¬ë°•ìŠ¤ê°€ disabledë˜ì–´ ìˆì–´ì•¼ í•˜ì§€ë§Œ, 
                                          // í˜¹ì‹œ ëª¨ë¥¼ ê²½ìš°ë¥¼ ëŒ€ë¹„í•˜ì—¬ ë‹¤ì‹œ í•œ ë²ˆ í•„í„°ë§í•©ë‹ˆë‹¤.
                                          return !checkbox.closest('tr').classList.contains('deleted-post');
                                      });

        // ğŸ’¡ [ê°œì„ ] alert ëŒ€ì‹  ì»¤ìŠ¤í…€ ëª¨ë‹¬ì´ë‚˜ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ì§€ë§Œ, ê¸°ì¡´ ë¡œì§ ìœ ì§€
        if (selectedCheckboxes.length === 0) {
            alert('ì¼ê´„ ì‚­ì œí•  ê²Œì‹œê¸€ì„ 1ê°œ ì´ìƒ ì„ íƒí•´ ì£¼ì„¸ìš”. (ì´ë¯¸ ì‚­ì œëœ ê²Œì‹œê¸€ì€ ì œì™¸ë©ë‹ˆë‹¤.)'); return;
        }
        
        // ğŸ’¡ [ê°œì„ ] confirm ëŒ€ì‹  ì»¤ìŠ¤í…€ ëª¨ë‹¬ì„ ì‚¬ìš©í•´ì•¼ í•˜ì§€ë§Œ, ê¸°ì¡´ ë¡œì§ ìœ ì§€
        if (confirm(`ì´ ${selectedCheckboxes.length}ê±´ì˜ ê²Œì‹œê¸€ì„ ì¼ê´„ ì‚­ì œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            const form = document.getElementById('bulkDeleteForm');
            form.innerHTML = '';
            
            // ì„ íƒëœ ëª¨ë“  ê²Œì‹œê¸€ ë²ˆí˜¸ë¥¼ hidden inputìœ¼ë¡œ ì¶”ê°€
            selectedCheckboxes.forEach(checkbox => {
                const hiddenInput = document.createElement('input');
                hiddenInput.type = 'hidden'; 
                // name='bbsNoList'ëŠ” Controllerì—ì„œ ë°›ëŠ” @RequestParam ì´ë¦„ì¼ ê°€ëŠ¥ì„±ì´ ë†’ìœ¼ë¯€ë¡œ ìœ ì§€
                hiddenInput.name = 'bbsNoList'; 
                hiddenInput.value = checkbox.value;
                form.appendChild(hiddenInput);
            });
            form.submit();
        }
    }

    // ì „ì²´ ì„ íƒ/í•´ì œ ë¡œì§
    document.addEventListener('DOMContentLoaded', (event) => {
        const selectAllCheckbox = document.getElementById('selectAllCheckboxPost');
        // :not(:disabled)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ ì‚­ì œëœ ê²Œì‹œê¸€ì˜ ì²´í¬ë°•ìŠ¤ëŠ” ì œì™¸
        const itemCheckboxes = document.querySelectorAll('.itemCheckboxPost:not(:disabled)');
        
        if (selectAllCheckbox) {
            selectAllCheckbox.addEventListener('change', function() { 
                itemCheckboxes.forEach(checkbox => { 
                    checkbox.checked = this.checked; 
                }); 
            });
        }

        itemCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                const checkedItems = document.querySelectorAll('.itemCheckboxPost:checked').length;
                // ì „ì²´ ê°œìˆ˜ëŠ” disabledê°€ ì•„ë‹Œ ì²´í¬ë°•ìŠ¤ ê°œìˆ˜
                const totalItems = itemCheckboxes.length; 
                
                if (selectAllCheckbox) {
                    if (!checkbox.checked) { 
                        selectAllCheckbox.checked = false; 
                    } else if (checkedItems === totalItems) { 
                        selectAllCheckbox.checked = true; 
                    }
                }
            });
        });
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ 'ê²Œì‹œê¸€ ê´€ë¦¬' ë©”ë‰´ë¥¼ ì—´ë¦° ìƒíƒœë¡œ ìœ ì§€
        const postManageMenu = document.getElementById('postManageMenu');
        if (postManageMenu && !postManageMenu.classList.contains('menu-open')) {
             postManageMenu.classList.add('menu-open');
        }
    });
 </script>
</body>
</html>
