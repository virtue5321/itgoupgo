<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>

<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ê´€ë¦¬ì - ê³µì§€ì‚¬í•­ ê´€ë¦¬</title>
<link rel="stylesheet" href="<c:url value="/resources/css/adminStyle.css" />">
<style>
/* í˜ì´ì§•ë°” ìŠ¤íƒ€ì¼ */
.pagination-container {
display: flex;
justify-content: center;
padding: 20px 0;
gap: 5px;
}
.pagination-container a, .pagination-container span {
padding: 8px 12px;
text-decoration: none;
color: #333;
border: 1px solid #ddd;
border-radius: 4px;
transition: background-color 0.3s;
}
.pagination-container a:hover {
background-color: #f0f0f0;
}
.pagination-container .active {
background-color: #5a5ce8;
color: white;
border-color: #5a5ce8;
}
.status-text.deleted { color: red; font-weight: bold; }
</style>
</head>
<body>
<c:import url="/WEB-INF/views/admin/adminNav.jsp" /> <%-- ê´€ë¦¬ì ë„¤ë¹„ê²Œì´ì…˜ í¬í•¨ (ê²½ë¡œ í™•ì¸ í•„ìš”) --%>

<div class="admin-container">
<h1 class="main-title">ê³µì§€ì‚¬í•­ ê²Œì‹œê¸€ ê´€ë¦¬</h1>

<!-- ê²€ìƒ‰ ë° í•„í„°ë§ ì˜ì—­ -->
<div class="search-area">
  <form action="searchNotice" method="GET" onsubmit="return validateSearch(this);">
    <select name="condition" class="search-select">
      <option value="title">ì œëª©</option>
      <option value="content">ë‚´ìš©</option>
      <option value="writer">ì‘ì„±ì</option>
    </select>
    <input type="text" name="keyword" class="search-input" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
    <button type="submit" class="btn btn-search">ê²€ìƒ‰</button>
  </form>
  <button class="btn btn-danger" onclick="deleteCheckedPosts(this.form)">ì„ íƒ ê¸€ ë¹„í™œì„±í™”</button>
</div>

<!-- ê²Œì‹œê¸€ ëª©ë¡ í…Œì´ë¸” -->
<form action="deleteCheckedNotice" method="POST" id="postManageForm">
  <table class="data-table">
    <thead>
      <tr>
        <th style="width: 5%;">
          <input type="checkbox" id="selectAllCheckboxPost">
        </th>
        <th style="width: 10%;">ë²ˆí˜¸</th>
        <th>ì œëª©</th>
        <th style="width: 15%;">ì‘ì„±ì(ID)</th>
        <th style="width: 15%;">ì‘ì„±ì¼</th>
        <th style="width: 10%;">ì¡°íšŒìˆ˜</th>
        <th style="width: 10%;">ìƒíƒœ</th>
        <th style="width: 10%;">ìƒì„¸</th>
      </tr>
    </thead>
    <tbody>
      <%-- ğŸ’¡ ê³µì§€ì‚¬í•­ ê²Œì‹œê¸€ ëª©ë¡ì´ Modelì— ë‹´ê²¨ìˆë‹¤ê³  ê°€ì • (noticeList) --%>
      <c:choose>
        <c:when test="${!empty noticeList}">
          <c:forEach var="notice" items="${noticeList}">
            <tr>
              <td>
                <input type="checkbox" class="itemCheckboxPost" name="postNoList" value="${notice.noticeNo}">
              </td>
              <td>${notice.noticeNo}</td>
              <td class="text-left">
                <a href="noticeDetail?no=${notice.noticeNo}" class="title-link">
                  ${notice.noticeTitle}
                </a>
              </td>
              <td>${notice.memberId}(${notice.memberNo})</td>
              <td><fmt:formatDate value="${notice.noticeCreateDate}" pattern="yyyy.MM.dd" /></td>
              <td>${notice.noticeView}</td>
              <td>
                <span class="status-text ${notice.noticeDeleteStatus eq 'Y' ? 'deleted' : 'active'}">
                  ${notice.noticeDeleteStatus eq 'Y' ? '[ë¹„í™œì„±]' : '[í™œì„±]'}
                </span>
              </td>
              <td>
                <a href="noticeDetail?no=${notice.noticeNo}" class="btn btn-sm btn-info">ìƒì„¸</a>
              </td>
            </tr>
          </c:forEach>
        </c:when>
        <c:otherwise>
          <tr>
            <td colspan="8">ì¡°íšŒëœ ê³µì§€ì‚¬í•­ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</td>
          </tr>
        </c:otherwise>
      </c:choose>
    </tbody>
  </table>
</form>

<!-- í˜ì´ì§•ë°” ì˜ì—­ (Placeholder) -->
<div class="pagination-container">
  <%-- ğŸ’¡ í˜ì´ì§€ë„¤ì´ì…˜ êµ¬í˜„ ìœ„ì¹˜ --%>
  <span>&laquo;</span>
  <span class="active">1</span>
  <a href="#">2</a>
  <a href="#">3</a>
  <span>&raquo;</span>
</div>


</div>

<script>
// ğŸ”´ 1. ê²€ìƒ‰ ìœ íš¨ì„± ê²€ì‚¬
function validateSearch(form) {
const keyword = form.keyword.value.trim();
if (keyword === "") {
alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
return false;
}
return true;
}

// ğŸ”´ 2. ì„ íƒëœ ê²Œì‹œê¸€ ì¼ê´„ ë¹„í™œì„±í™” (POST ìš”ì²­)
function deleteCheckedPosts(form) {
    const selectedCheckboxes = document.querySelectorAll(&#39;.itemCheckboxPost:checked&#39;);

    if (selectedCheckboxes.length === 0) {
        alert(&quot;ì‚­ì œí•  ê²Œì‹œê¸€ì„ í•˜ë‚˜ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.&quot;);
        return;
    }

    if (confirm(`ì„ íƒëœ ê²Œì‹œê¸€ ${selectedCheckboxes.length}ê°œë¥¼ ì •ë§ë¡œ ë¹„í™œì„±í™”(ì‚­ì œ ì²˜ë¦¬)í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        // í¼ ì•¡ì…˜ê³¼ ë©”ì†Œë“œ ì„¤ì •
        form.action = &quot;&lt;c:url value=&quot;/admin/deleteCheckedNotice&quot; /&gt;&quot;;
        form.method = &quot;POST&quot;;
        
        // ì „ì†¡ì„ ìœ„í•´ í¼ì— ì¼ê´„ ì‚­ì œìš© íˆë“  ì¸í’‹ ì¶”ê°€ (Controllerì—ì„œ postNoListë¡œ ë°›ì„ ê²ƒì„ ê°€ì •)
        const formElement = document.getElementById(&#39;postManageForm&#39;);
        
        // ê¸°ì¡´ íˆë“  ì¸í’‹ ì œê±°
        formElement.querySelectorAll(&#39;input[name=&quot;postNoList&quot;]&#39;).forEach(input =&gt; input.remove());
        
        selectedCheckboxes.forEach(checkbox =&gt; {
            const hiddenInput = document.createElement(&#39;input&#39;);
            hiddenInput.type = &#39;hidden&#39;;
            hiddenInput.name = &#39;postNoList&#39;; // Controllerì˜ @RequestParam ì´ë¦„ê³¼ ì¼ì¹˜
            hiddenInput.value = checkbox.value;
            formElement.appendChild(hiddenInput);
        });
        
        formElement.submit(); 
    }
}

// ğŸ”´ 3. ì²´í¬ë°•ìŠ¤ ì „ì²´ ì„ íƒ/í•´ì œ ê¸°ëŠ¥
document.addEventListener(&#39;DOMContentLoaded&#39;, (event) =&gt; {
    const selectAllCheckbox = document.getElementById(&#39;selectAllCheckboxPost&#39;);
    const itemCheckboxes = document.querySelectorAll(&#39;.itemCheckboxPost&#39;);

    if (selectAllCheckbox) {
        selectAllCheckbox.addEventListener(&#39;change&#39;, function() {
            itemCheckboxes.forEach(checkbox =&gt; {
                checkbox.checked = this.checked;
            });
        });
    }
    
    itemCheckboxes.forEach(checkbox =&gt; {
        checkbox.addEventListener(&#39;change&#39;, () =&gt; {
            const checkedItems = document.querySelectorAll(&#39;.itemCheckboxPost:checked&#39;).length;
            if (!checkbox.checked) {
                if (selectAllCheckbox) selectAllCheckbox.checked = false;
            } else if (checkedItems === itemCheckboxes.length) {
                if (selectAllCheckbox) selectAllCheckbox.checked = true;
            }
        });
    });
});


</script>

</body>
</html>