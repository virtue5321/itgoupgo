<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>  <!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>통계</title>
  <link rel="stylesheet" href="<c:url value="/resources/css/adminStyle.css" />">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
</head>
<body>
  <header>
    <div class="logo">
      <img src="<c:url value="/resources/images/logo.png" />" width="80">
      관리자 페이지
    </div>
  </header>

  <div class="layout">
    <aside class="sidebar">
      <ul>
        <li><a href="<c:url value="/admin/dashboard" />">🏠 대시보드</a></li>
        <li><a href="<c:url value="/admin/member" />">👥 회원 관리</a></li>
        <li><a href="<c:url value="/admin/post" />">📝 게시글 관리</a></li>
        <li><a href="<c:url value="/admin/reply" />">💬 댓글 관리</a></li>
        <li><a href="<c:url value="/admin/stats" />" class="active">📊 통계</a></li>
        <li><a href="<c:url value="/admin/logout" />">🚪 로그아웃</a></li>
      </ul>
    </aside>

    <main>
      <h1>📊 통계</h1>
      <p>사이트 활동에 대한 심층 통계 데이터를 확인합니다.</p>

      <div style="margin-bottom: 30px; display:flex; gap:10px; align-items:center; background:#fff; padding:15px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
        <label style="font-weight:600;">데이터 조회 기간:</label>
        <select id="periodSelect" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
          <option value="weekly">최근 7일</option>
          <option value="monthly">최근 30일</option>
          <option value="custom" disabled>사용자 지정 (미구현)</option>
        </select>
        <button id="queryButton" style="background:#5a5ce8; color:white; border:none; padding:8px 15px; border-radius:4px; cursor:pointer;">조회</button>
      </div>

      <div style="display:flex; gap:20px; margin-top:20px;">
        
        <div style="flex:2; background:#fff; padding:20px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
          <h3 id="trafficTitle">기간별 방문자 추이 (UV/PV)</h3>
          <div style="height:250px; margin-top:15px;">
            <canvas id="trafficChart"></canvas>
          </div>
        </div>

        <div style="flex:1; background:#fff; padding:20px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
          <h3 id="memberTitle">회원 가입 추이</h3>
          <div style="height:250px; margin-top:15px;">
            <canvas id="memberChart"></canvas>
          </div>
        </div>
      </div>

      <div style="display:flex; gap:20px; margin-top:20px;">
        
        <div style="flex:1; background:#fff; padding:20px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
          <h3>게시판별 콘텐츠 비율 (누적)</h3>
          <div style="height:200px; padding:15px; display:flex; align-items:center; justify-content:center;">
            <canvas id="ratioChart" style="max-height: 200px;"></canvas>
          </div>
        </div>

        <div style="flex:1; background:#fff; padding:20px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
          <h3>👍 인기 게시글 TOP 5 (좋아요 순)</h3>
          <table border="1" cellpadding="10" cellspacing="0" style="width:100%; background:white; border-collapse:collapse; text-align:center; margin-top:15px;">
            <tr style="background:#f3f4f6;">
              <th>순위</th><th>제목</th><th>좋아요 수</th>
            </tr>
            <tr><td>1</td><td style="text-align:left;"><a href="#" style="color:#5a5ce8; text-decoration:none;">사이트 기능 팁 모음</a></td><td>587</td></tr>
            <tr><td>2</td><td style="text-align:left;"><a href="#" style="color:#5a5ce8; text-decoration:none;">새로운 UI/UX 피드백</a></td><td>420</td></tr>
            <tr><td>3</td><td style="text-align:left;"><a href="#" style="color:#5a5ce8; text-decoration:none;">주간 베스트 코멘트</a></td><td>350</td></tr>
            <tr><td>4</td><td style="text-align:left;"><a href="#" style="color:#5a5ce8; text-decoration:none;">운영진에게 질문!</a></td><td>295</td></tr>
            <tr><td>5</td><td style="text-align:left;"><a href="#" style="color:#5a5ce8; text-decoration:none;">이번 주 이슈 총정리</a></td><td>210</td></tr>
          </table>
        </div>

        <div style="flex:1; background:#fff; padding:20px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
          <h3>💬 댓글 작성자 TOP 5</h3>
          <table border="1" cellpadding="10" cellspacing="0" style="width:100%; background:white; border-collapse:collapse; text-align:center; margin-top:15px;">
            <tr style="background:#f3f4f6;">
              <th>순위</th><th>작성자</th><th>댓글 수</th>
            </tr>
            <tr><td>1</td><td>active_user</td><td>125</td></tr>
            <tr><td>2</td><td>comment_king</td><td>98</td></tr>
            <tr><td>3</td><td>daily_poster</td><td>77</td></tr>
            <tr><td>4</td><td>user123</td><td>55</td></tr>
            <tr><td>5</td><td>admin_helper</td><td>42</td></tr>
          </table>
        </div>
      </div>
    </main>
  </div>

  <footer>ⓒ 2025 IT GO UP GO. All Rights Reserved.</footer>

<script>
// JavaScript/Chart.js 코드는 그대로 유지
    document.addEventListener('DOMContentLoaded', (event) => {
        // 1. 데이터 정의
        const dataSets = {
            weekly: {
                trafficLabels: ['월', '화', '수', '목', '금', '토', '일'],
                trafficData: [1200, 1500, 1000, 1800, 1400, 2200, 1900],
                memberLabels: ['1주', '2주', '3주', '4주'],
                memberData: [150, 120, 180, 140],
                trafficTitle: '최근 7일간 일별 방문자 추이'
            },
            monthly: {
                trafficLabels: ['1주차', '2주차', '3주차', '4주차'],
                trafficData: [10500, 12800, 9500, 15000],
                memberLabels: ['1월', '2월', '3월', '4월', '5월'],
                memberData: [500, 800, 1200, 650, 900],
                trafficTitle: '최근 30일간 주별 방문자 추이'
            }
        };

        // 2. 초기 차트 설정
        const trafficCtx = document.getElementById('trafficChart').getContext('2d');
        const memberCtx = document.getElementById('memberChart').getContext('2d');
        const ratioCtx = document.getElementById('ratioChart').getContext('2d');

        const commonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: { x: { grid: { display: false } }, y: { beginAtZero: true } }
        };

        const trafficChart = new Chart(trafficCtx, {
            type: 'line',
            data: {
                labels: dataSets.weekly.trafficLabels,
                datasets: [{
                    label: '방문자 수',
                    data: dataSets.weekly.trafficData,
                    borderColor: '#5a5ce8',
                    backgroundColor: 'rgba(90, 92, 232, 0.1)',
                    tension: 0.3,
                    fill: true
                }]
            },
            options: commonOptions
        });

        const memberChart = new Chart(memberCtx, {
            type: 'bar',
            data: {
                labels: dataSets.weekly.memberLabels,
                datasets: [{
                    label: '신규 가입자 수',
                    data: dataSets.weekly.memberData,
                    backgroundColor: '#28a745'
                }]
            },
            options: commonOptions
        });

        const ratioChart = new Chart(ratioCtx, {
            type: 'doughnut',
            data: {
                labels: ['공지사항', '정보 나눔', '자유 게시판'],
                datasets: [{
                    data: [120, 350, 880], // 임시 데이터
                    backgroundColor: ['#5a5ce8', '#28a745', '#ffc107'],
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed !== null) {
                                    label += context.parsed;
                                }
                                return label + '건';
                            }
                        }
                    }
                }
            }
        });


        // 3. 차트 업데이트 함수
        function updateCharts(period) {
            const data = dataSets[period];
            if (!data) return;

            document.getElementById('trafficTitle').textContent = data.trafficTitle;

            // 방문자 차트 업데이트
            trafficChart.data.labels = data.trafficLabels;
            trafficChart.data.datasets[0].data = data.trafficData;
            trafficChart.update();

            // 회원 차트 업데이트
            memberChart.data.labels = data.memberLabels;
            memberChart.data.datasets[0].data = data.memberData;
            memberChart.update();
        }

        // 4. 이벤트 리스너
        document.getElementById('queryButton').addEventListener('click', () => {
            const period = document.getElementById('periodSelect').value;
            updateCharts(period);
        });
    });
</script>
</body>
</html>